// ==UserScript==
// @name           extend-luogu
// @namespace      http://tampermonkey.net/
// @description    Make luogu more powerful.
// @description:zh 使洛谷拥有更多功能
// @icon           https://raw.fastgit.org/extend-luogu/extend-luogu/main/favicon.ico
// @icon64         https://exlg.cc/img/logo.png
// @homepage       https://exlg.cc
// @version        6.4.0
//
// @match          https://*.luogu.com.cn/*
// @match          https://*.luogu.org/*
// @match          https://www.bilibili.com/robots.txt?*
// @match          https://service-ig5px5gh-1305163805.sh.apigw.tencentcs.com/release/APIGWHtmlDemo-1615602121
// @match          https://service-nd5kxeo3-1305163805.sh.apigw.tencentcs.com/release/exlg-nextgen
// @match          https://extend-luogu.github.io/exlg-setting-new/*
// @match          https://dash.exlg.cc/*
// @include        http://localhost:1634/*
//
// @connect        tencentcs.com
// @connect        luogulo.gq
// @connect        bens.rotriw.com
// @connect        codeforces.com
// @connect        codeforces.ml
// @connect        codeforc.es
// @connect        kenkoooo.com
// @connect        api.github.com
// @connect        exlg.piterator.com
// @connect        luogu-captcha-bypass.piterator.com
// @connect        exlgcs.jin-dan.site
//
// @require        https://cdn.luogu.com.cn/js/jquery-2.1.1.min.js
// @require        https://cdn.jsdelivr.net/gh/leizongmin/js-xss@1.0.10/dist/xss.min.js
// @require        https://cdn.jsdelivr.net/gh/markedjs/marked@2.0.1/marked.min.js
// @require        https://cdn.jsdelivr.net/gh/ForkKILLET/TM-dat@0.8.3/TM-dat.user.js
//
// @resource       colorpicker https://gitee.com/xiannvzuo/xncolorpicker/raw/main/dist/xncolorpicker.min.js
//
// @grant          GM_addStyle
// @grant          GM_getValue
// @grant          GM_setValue
// @grant          GM_deleteValue
// @grant          GM_listValues
// @grant          GM_setClipboard
// @grant          GM_xmlhttpRequest
// @grant          GM_getResourceText
// @grant          unsafeWindow
// ==/UserScript==

;
(()=>{var J=unsafeWindow,_=J;function ie(e){return new Proxy(e,{get(t,o){return o==="then"?n=>(t.then(n),ie(t)):ie(t.then(n=>n[o]))}})}var M=(e,...t)=>J.console.log(`%c[exlg] ${e}`,"color: #0e90d2;",...t),Z=(e,...t)=>J.console.warn(`%c[exlg] ${e}`,"color: #0e90d2;",...t),O=(e,...t)=>{throw J.console.error(`%c[exlg] ${e}`,"color: #0e90d2;",...t),Error(t.join(" "))},w,L;location.host==="www.luogu.com.cn"&&!/blog/g.test(location.href)&&(/(\?|&)_contentOnly($|=)/g.test(location.search)&&O("Content-Only pages."),J._feInjection.code!==200&&O("Luogu failed to load. Exlg stops loading."),w=J._feInjection.currentData,L=J._feInjection.currentUser);var $e=e=>[e.ctrlKey?"Ctrl":"",e.shiftKey?"Shift":"",e.altKey?"Alt":"",e.key.toInitialCase()].join(""),r=jQuery.extend({double:(e,t,o)=>[e(t),e(o)]});jQuery.fn.extend({whenKey(e,t){typeof e=="object"?this.on("keydown",o=>{let n=e[$e(o)];n&&n(o)}):this.on("keydown",o=>{$e(o)===e&&t(o)})}});var Q=new filterXSS.FilterXSS({onTagAttr:(e,t,o)=>{if(t==="style")return`${t}="${o}"`}});Date.prototype.format=function(e,t){t=t?"UTC":"";let o={"y+":this[`get${t}FullYear`](),"m+":this[`get${t}Month`]()+1,"d+":this[`get${t}Date`](),"H+":this[`get${t}Hours`](),"M+":this[`get${t}Minutes`](),"S+":this[`get${t}Seconds`](),"s+":this[`get${t}Milliseconds`]()};for(let n in o)RegExp(`(${n})`).test(e)&&(e=e.replace(RegExp.$1,`000${o[n]}`.substr(o[n].toString().length+3-RegExp.$1.length)));return e};String.prototype.toInitialCase=function(){return this[0].toUpperCase()+this.slice(1)};Array.prototype.lastElem=function(){return this[this.length-1]};var Ce=e=>new Promise(t=>setTimeout(t,e)),K=(e,t)=>{if(!e)return"<<";let o=(g,f)=>g===f?"==":g<f?"<<":">>",n=["pre","alpha","beta"],[[l,a],[i,s]]=[e,t].map(g=>g.split("-")),[c,d]=l===i?[a,s].map(g=>[g?n.findIndex(f=>g.startsWith(f)):1/0,g?.match(/[0-9]+$/g)?.[0]??1/0]):[l,i].map(g=>g.split("."));for(let[g,f]of c.entries())if(f!==d[g])return o(+f||0,+d[g]||0);return"=="},se=(e,t)=>{let o=new URLSearchParams;for(let l in e)o.set(l,e[l]);let n=r(`
        <iframe id="exlg-${e.type}" src=" https://www.bilibili.com/robots.txt?${o}" style="${t}" exlg="exlg"></iframe>
    `);return M("Building springboard: %o",n[0]),n},F=({url:e,onload:t,onerror:o=n=>O(n)})=>GM_xmlhttpRequest({url:e,method:"GET",onload:t,onerror:o}),be=(e,t={})=>{let o=new Promise((n,l)=>{GM_xmlhttpRequest({url:e,method:"GET",headers:t,onload:a=>{try{a.data=JSON.parse(a.responseText)}catch{}n(a)},onerror:l})});return ie(o)},G=(e,t,o={},n="application/json")=>{let l=new Promise((a,i)=>{GM_xmlhttpRequest({url:e,method:"POST",data:typeof t!="string"?JSON.stringify(t):t,headers:{"Content-Type":typeof t=="string"?n:"application/json",...o},onload:s=>{try{s.data=JSON.parse(s.responseText)}catch{}a(s)},onerror:i})});return ie(l)},B=(e=1e3)=>~~(Date.now()/e),H=e=>new Promise((t,o)=>{r.get(`${e+(e.includes("?")?"&":"?")}_contentOnly=1`,n=>{n.code!==200&&o(new Error(`Requesting failure code: ${t.code}.`)),t(n)})}),ce=(e,t="exlg 提醒您")=>J.show_alert?J.show_alert(t,e):J.alert(`${t}
${e}`),he=null,Y=(e,t)=>r.ajax({url:e,data:t,headers:{"x-csrf-token":he===null?he=r("meta[name=csrf-token]").attr("content"):he,"content-type":"application/json"},method:"post"}),ee=e=>[/^AT[1-9][0-9]{0,}$/i,/^CF[1-9][0-9]{0,}[A-Z][0-9]?$/i,/^SP[1-9][0-9]{0,}$/i,/^P[1-9][0-9]{3,}$/i,/^UVA[1-9][0-9]{2,}$/i,/^U[1-9][0-9]{0,}$/i,/^T[1-9][0-9]{0,}$/i,/^B[2-9][0-9]{3,}$/i].some(t=>t.test(e)),xe=(e,t)=>e.map(o=>({dft:o,...t}));var W={_:new Map,reg:(e,t,o,n,l)=>{W._.set(e,{description:t,alias:o,icon:n,unclosable:l})},alias:e=>{let t=W._.get(e);return t?t.alias:""},register:()=>{M("Registering categories"),W.reg("core","核心","@","bug_report",!0),W.reg("module","模块","","tunes",!1),W.reg("admin","管理模块","!","build",!1),W.reg("chore","定时任务","^","alarm",!0),W.reg("component","组件","#","widgets",!0)}};W.register();var z=W;var de=`<svg xmlns="http://www.w3.org/2000/svg" height="30" viewBox="0 0 136.14 30.56">
<g transform="translate(1.755, 0)" fill="#00a0d8">
    <g>
        <path d="M5.02-33.80L34.56-33.80L34.07-28.62L16.96-28.62L15.93-21.92L31.97-21.92L31.48-16.74L14.85-16.74L13.82-8.42L31.97-8.42L31.48-3.24L2.43-3.24L6.59-31.75L5.02-33.80Z" transform="translate(-4.14, 33.9)"></path>
        <path d="M7.34-32.29L5.78-33.80L16.63-33.80L21.33-25.00L27.54-32.78L26.51-33.80L38.93-33.80L25.49-18.79L34.78-3.24L24.41-3.24L19.76-12.58L11.99-3.24L1.62-3.24L15.12-18.79L7.34-32.29Z" transform="translate(27.23, 33.9)"></path>
        <path d="M4.00-33.80L16.42-33.80L12.80-8.42L32.99-8.42L32.51-3.24L5.56-3.24Q4.00-3.24 3.21-4.27Q2.43-5.29 2.43-6.86L2.43-6.86L5.56-31.75L4.00-33.80Z" transform="translate(63.8, 33.9)"></path>
        <path d="M38.83-33.80L37.80-25.00L27.43-25.00L27.92-28.62L15.50-28.62L12.91-8.42L25.33-8.42L25.87-14.63L22.73-19.82L36.72-19.82L34.67-3.24L5.62-3.24Q4.86-3.24 4.21-3.51Q3.56-3.78 3.10-4.27Q2.65-4.75 2.48-5.43Q2.32-6.10 2.54-6.86L2.54-6.86L6.16-33.80L38.83-33.80Z" transform="translate(95.6, 33.9)"></path>
    </g>
</g>
</svg>`,Le=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="%" style="margin-bottom: -3px;" exlg="exlg">
    <path d="M16 8C16 6.84375 15.25 5.84375 14.1875 5.4375C14.6562 4.4375 14.4688 3.1875 13.6562 2.34375C12.8125 1.53125 11.5625 1.34375 10.5625 1.8125C10.1562 0.75 9.15625 0 8 0C6.8125 0 5.8125 0.75 5.40625 1.8125C4.40625 1.34375 3.15625 1.53125 2.34375 2.34375C1.5 3.1875 1.3125 4.4375 1.78125 5.4375C0.71875 5.84375 0 6.84375 0 8C0 9.1875 0.71875 10.1875 1.78125 10.5938C1.3125 11.5938 1.5 12.8438 2.34375 13.6562C3.15625 14.5 4.40625 14.6875 5.40625 14.2188C5.8125 15.2812 6.8125 16 8 16C9.15625 16 10.1562 15.2812 10.5625 14.2188C11.5938 14.6875 12.8125 14.5 13.6562 13.6562C14.4688 12.8438 14.6562 11.5938 14.1875 10.5938C15.25 10.1875 16 9.1875 16 8ZM11.4688 6.625L7.375 10.6875C7.21875 10.8438 7 10.8125 6.875 10.6875L4.5 8.3125C4.375 8.1875 4.375 7.96875 4.5 7.8125L5.3125 7C5.46875 6.875 5.6875 6.875 5.8125 7.03125L7.125 8.34375L10.1562 5.34375C10.3125 5.1875 10.5312 5.1875 10.6562 5.34375L11.4688 6.15625C11.5938 6.28125 11.5938 6.5 11.4688 6.625Z"></path></svg>`,Me='<svg data-v-a97ae32a="" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="code" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svg-inline--fa fa-code fa-w-20"><path data-v-a97ae32a="" fill="currentColor" d="M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z" class=""></path></svg>',Se=`<svg aria-hidden="true" height="12" viewBox="0 0 16 16" version="1.1" width="12" data-view-component="true" class="octicon octicon-mark-github">
<path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
</svg>`,Ee='<svg class="icon" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" width="24" height="24" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5446"><path d="M512 128c-211.7 0-384 172.3-384 384s172.3 384 384 384 384-172.3 384-384-172.3-384-384-384z m0 717.4c-183.8 0-333.4-149.6-333.4-333.4S328.2 178.6 512 178.6 845.4 328.2 845.4 512 695.8 845.4 512 845.4zM651.2 372.8c-9.9-9.9-25.9-9.9-35.8 0L512 476.2 408.6 372.8c-9.9-9.9-25.9-9.9-35.8 0-9.9 9.9-9.9 25.9 0 35.8L476.2 512 372.8 615.4c-9.9 9.9-9.9 25.9 0 35.8 4.9 4.9 11.4 7.4 17.9 7.4s13-2.5 17.9-7.4L512 547.8l103.4 103.4c4.9 4.9 11.4 7.4 17.9 7.4s13-2.5 17.9-7.4c9.9-9.9 9.9-25.9 0-35.8L547.8 512l103.4-103.4c9.9-9.9 9.9-25.9 0-35.8z" p-id="5447"></path></svg>',Te=`<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="door-open" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="svg-inline--fa fa-door-open fa-w-20">
<path data-v-450d4937="" data-v-303bbf52="" fill="currentColor" d="M624 448h-80V113.45C544 86.19 522.47 64 496 64H384v64h96v384h144c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM312.24 1.01l-192 49.74C105.99 54.44 96 67.7 96 82.92V448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h336V33.18c0-21.58-19.56-37.41-39.76-32.17zM264 288c-13.25 0-24-14.33-24-32s10.75-32 24-32 24 14.33 24 32-10.75 32-24 32z"></path>
</svg>`,je='<svg class="icon exlg-usercom-edit" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="942"><path d="M295.384615 708.923077h433.23077a19.692308 19.692308 0 1 1 0 39.384615h-433.23077a19.692308 19.692308 0 1 1 0-39.384615zM590.769231 303.576615L618.653538 275.692308l72.979693 73.019077-27.844923 27.844923L590.769231 303.576615z m-236.307693 196.923077L382.345846 472.615385l89.284923 89.324307-27.844923 27.844923L354.461538 500.499692zM401.329231 616.841846l308.342154-308.342154-55.689847-55.689846-308.381538 308.342154-8.152615 63.881846 63.881846-8.192z m-93.065846-74.043077l317.833846-317.833846a39.384615 39.384615 0 0 1 55.729231 0l55.689846 55.689846a39.384615 39.384615 0 0 1 0 55.689846l-317.833846 317.833847-127.763693 16.344615 16.344616-127.724308z" p-id="943"></path></svg>';var N={};var we=class{constructor(){this.fq=[]}push(t){this.fq.push(t)}apply(){this.fq.forEach(t=>t())}},it=Object.fromEntries(["onload","preload"].map(e=>[e,new we])),ne=it;var E=null,k={_:new Map,fake_sto:E,data:{},path_alias:[["",".*\\.luogu\\.(com\\.cn|org)"],["dash","dash.exlg.cc"],["cdn","cdn.luogu.com.cn"],["bili","www.bilibili.com"],["tcs1","service-ig5px5gh-1305163805.sh.apigw.tencentcs.com"],["tcs2","service-nd5kxeo3-1305163805.sh.apigw.tencentcs.com"],["tcs3","service-otgstbe5-1305163805.sh.apigw.tencentcs.com"],["debug","localhost:1634"],["ghpage","extend-luogu.github.io"]].map(([e,t])=>[new RegExp(`^@${e}/`),t]),path_dash_board:["@dash/((index|bundle)(.html)?)?","@ghpage/exlg-setting-new/((index|bundle)(.html)?)?","@debug/exlg-setting-new/((index|bundle).html)?"],reg:(e,t,o,n,l,a,i)=>{Array.isArray(o)||(o=[o]),o.forEach((c,d)=>{k.path_alias.some(([g,f])=>c.match(g)?(o[d]=c.replace(g,`${f}/`),!0):!1),c.endsWith("$")||(o[d]+="$")});let s=z.alias(i)+e;k.data[s]={ty:"object",lvs:n||{}},"on"in k.data[s].lvs||(k.data[s].lvs.on={ty:"boolean",dft:!0}),N[s]=k.data[s],t=t.replaceAll(" ","_"),k._.set(e,{info:t,path:o,func:l,styl:a,cate:i})},reg_pre:(e,t,o,n,l,a,i,s)=>{k.reg(e,t,o,n,a,i,s),k._.set(e,{pre:l,...k._.get(e)})},_regv2_invoker:(e,t)=>{let o=a=>(Array.isArray(a)||(a=[a]),a.map(i=>(k.path_alias.some(([s,c])=>i.match(s)?(i=i.replace(s,`${c}/`),!0):!1),i.endsWith("$")||(i+="$"),i))),n=(a,i)=>{if(typeof i=="object"&&a in i)return i[a]};e=o(e);let l=(a,i,s,c)=>{i=i?o(i):[];let d=n(a,t.private);n("on",d)!==!1&&i.concat(e).some(f=>RegExp(f).test(location.href))&&ne[s].push((...f)=>c({msto:d,gsto:t.public},...f))};return{onload:({name:a,path:i},s,c)=>l(a,i,"onload",c),preload:({name:a,path:i},s,c)=>l(a,i,"preload",c),chore:({name:a,period:i},s,c)=>{if(typeof i=="string"){let d=+i.slice(0,-1),g={s:1e3,m:1e3*60,h:1e3*60*60,D:1e3*60*60*24}[i.slice(-1)];!isNaN(d)&&g?i=d*g:O(`Parsing period failed: "${i}"`)}l(a,"@/.*","preload",async d=>{let g=d.msto.last_chore,f=B(1);!g||f-g>i?await c(d)?Z(`Chore failed: "${a}"`):d.msto.last_chore=B(1):M(`Pending chore: "${a}"`)})},hook:({name:a,path:i},s,c,d)=>l(a,i,"preload",g=>{r("body").on("DOMNodeInserted",f=>{if(!f.target.tagName)return!1;let x=d(f);return x.result&&c({...g,...x})})})}},reg_v2:({name:e,info:t,path:o,cate:n},l,a,i)=>{t=t.replaceAll(" ","_");let s={},c=[],d=($,...m)=>s=Object.fromEntries(Object.entries(s).concat(Object.entries($).map(([u,b])=>{let y=b.migration===!0?u:b.migration;return c.push([y,m.concat(u)]),[y,{...b,priv:!0}]}))),g=z.alias(n)+e,f=Object.entries(l??{}).filter(([$])=>$!=="on");d(f,"public"),N[g]={ty:"object",lvs:{...f&&{public:{ty:"object",lvs:Object.fromEntries(f)}},private:{ty:"object",lvs:{}},on:{ty:"boolean",dft:l?.on?.dft??!0}}};let x=[];a(($=>{let m=(u,b)=>{b&&($.private.lvs[u]={ty:"object",lvs:b},d(b,"private",u))};return new Proxy({onload:(u,b)=>m(u.name,b),preload:(u,b)=>m(u.name,b),chore:(u,b)=>m(u.name,{...b,last_chore:{ty:"number",dft:-1,priv:!0}}),hook:(u,b)=>m(u.name,b)},{get:(u,b)=>(...y)=>{x.push([b,...y]),u[b](...y)}})})(N[g].lvs)),N[g].lvs={...N[g].lvs,...s},k._.set(e,{info:t,path:o,data:l,func:a,subfuncs:x,migrlist:c,styl:i,cate:n})},reg_main:(e,t,o,n,l,a)=>k.reg(e,t,o,n,i=>(l(i),!1),a,"core"),reg_user_tab:(e,t,o,n,l,a,i,s)=>k.reg(e,t,"@/user/.*",l,c=>{let d=r(".items"),g=()=>{(location.hash||"#main")===`#${o}`&&(M(`Working user tab#${o} mod: "${e}"`),a({...c,vars:n}))};d.on("click",g),g()},i,s),reg_chore:(e,t,o,n,l,a,i)=>{if(typeof o=="string"){let s=+o.slice(0,-1),c={s:1e3,m:1e3*60,h:1e3*60*60,D:1e3*60*60*24}[o.slice(-1)];!isNaN(s)&&c?o=s*c:O(`Parsing period failed: "${o}"`)}l={...l,last_chore:{ty:"number",dft:-1,priv:!0}},k.reg(e,t,n,l,async s=>{let c=E[`^${e}`].last_chore,d=B(1),g=!0;s.named||!c||d-c>o?(g&&(GM_addStyle(i),g=!1),await a(s)?Z(`Chore failed: "${e}"`):E[`^${e}`].last_chore=B(1)):M(`Pending chore: "${e}"`)},`
            `,"chore")},reg_board:(e,t,o,n,l,a)=>k.reg(e,t,"@/",o,i=>{let s=r("#exlg-board");s.length||(s=r(`
                    <div class="lg-article" id="exlg-board" exlg="exlg"><h2>${de} &nbsp;&nbsp;${GM_info.script.version}</h2></div>
                `).prependTo(".lg-right.am-u-md-4"),s[0].firstChild.style["font-size"]="1em"),n({...i,$board:r("<div></div>").appendTo(s)})},l,a),reg_hook:(e,t,o,n,l,a,i,s)=>k.reg(e,t,o,n,c=>{l(c),r("body").bind("DOMNodeInserted",d=>a(d)&&l(c))},i,s),reg_hook_new:(e,t,o,n,l,a,i,s,c)=>k.reg(e,t,o,n,d=>{l({...d,result:!1,args:i()}),r("body").bind("DOMNodeInserted",g=>{if(!g.target.tagName)return!1;let f=a(g);return f.result&&l({...d,...f})})},s,c),reg_lfe:(e,t,o,n,l,a,i)=>{k.reg(e,t,o,n,l,a,i),k._.set(e,{lfe:!0,...k._.get(e)})},find:e=>k._.get(e),has:e=>k._.has(e),disable:e=>{let t=k.find(e);t.on=!1,k._.set(e,t)},enable:e=>{let t=k.find(e);t.on=!0,k._.set(e,t)},execute_v2:()=>{for(let[e,t]of k._.entries()){let o=z.alias(t.cate)+e;if(E[o].on&&t.subfuncs){if(Array.isArray(t.migrlist)){for(let[l,a]of t.migrlist)if(E[o][l]!==N[o].lvs[l].dft){let i=E[o],s=a.slice(0,-1);for(let c of s)i=i[c];i[a.lastElem()]=E[o][l],E[o][l]=N[o].lvs[l].dft}}let n=k._regv2_invoker(t.path,E[o]);for(let l of t.subfuncs)n[l[0]](...l.slice(1))}}},preload:e=>{E===null&&(E=k.fake_sto);let t=(n,l)=>{n||O(`Preloading named mod but not found: "${e}"`),M(`Preloading ${l?"named ":""}mod: "${n.name}"`);try{return{pred:n.pre({msto:E[z.alias(n.cate)+n.name],named:l}),...n}}catch(a){return Z(a),n}},o=location.href;for(let[n,l]of k._.entries())E[z.alias(l.cate)+n].on&&l.path.some(a=>new RegExp(a,"g").test(o))&&(l.willrun=!0,"pre"in l&&k._.set(n,t({name:n,...l})));_.console.info=n=>{let l=console.info(n);if(M(`info hooked: ${n}`),n==="[@lfe/loader]")for(let[a,i]of k._.entries())E[z.alias(i.cate)+a].on&&i.path.some(s=>new RegExp(s,"g").test(o))&&"lfe"in i&&(k.execute(a),M(`loading lfe module: ${a}`));return l}},execute:e=>{let t=(o,n)=>(o||O(`Executing named mod but not found: "${e}"`),o.styl&&GM_addStyle(o.styl),M(`Executing ${n?"named ":""}mod: "${o.name}"`),"pred"in o?o.func({msto:E[z.alias(o.cate)+o.name],named:n,pred:o.pred}):o.func({msto:E[z.alias(o.cate)+o.name],named:n}));if(e){let o=k.find(e);return t({name:e,...o},!0)}for(let[o,n]of k._.entries())if(n.on=E[z.alias(n.cate)+o].on,n.willrun&&t({name:o,...n})===!1)break}},h=k;h.reg("benben","全网犇犇","@/",{source:{ty:"enum",dft:"o2",vals:["o2","shy"],info:["Source","切换全网犇犇获取方式"]},reply_with_md:{ty:"boolean",dft:!1,info:["Reply with markdown","回复时附上原 markdown"]}},({msto:e})=>{let t={Gray:"gray",Blue:"bluelight",Green:"green",Orange:"orange lg-bold",Red:"red lg-bold",Purple:"purple lg-bold",Cheater:"brown lg-bold"},o='&nbsp;<a class="sb_amazeui" target="_blank" href="/discuss/show/142324">$</a>',n=i=>i<=3?"":o.replace("$",Le.replace("%",i<=5?"#5eb95e":i<=7?"#3498db":"#f1c40f")),l=_.loadFeed;_.loadFeed=function(){_.feedMode==="all-exlg"?(F({url:e.source==="o2"?"https://service-ig5px5gh-1305163805.sh.apigw.tencentcs.com/release/APIGWHtmlDemo-1615602121":`https://bens.rotriw.com/api/list/proxy?page=${_.feedPage}`,onload:i=>{JSON.parse(i.response).forEach(c=>{let d=marked(Q.process(c.content));r(`
                <li class="am-comment am-comment-primary feed-li" exlg="exlg">
                    <div class="lg-left">
                        <a href="/user/${c.user.uid}" class="center">
                            <img src="https://cdn.luogu.com.cn/upload/usericon/${c.user.uid}.png" class="am-comment-avatar">
                        </a>
                    </div>
                    <div class="am-comment-main">
                        <header class="am-comment-hd">
                            <div class="am-comment-meta">
                                <span class="feed-username">
                                    <a class="lg-fg-${t[c.user.color]}" href="/user/${c.user.uid}" target="_blank">${c.user.name}</a>${n(c.user.ccfLevel)}${c.user.badge?`&nbsp;<span class="am-badge am-radius lg-bg-${t[c.user.color]}">${c.user.badge}</span>`:""}
                                </span>
                                ${new Date(c.time*1e3).format("yyyy-mm-dd HH:MM")}
                                <a name="feed-reply">回复</a>
                            </div>
                        </header>
                        <div class="am-comment-bd">
                            <span class="feed-comment">
                                ${d}
                            </span>
                        </div>
                    </div>
                </li>
            `).appendTo(r("ul#feed")).find("a[name=feed-reply]").on("click",()=>{scrollToId("feed-content"),setTimeout(()=>r("textarea").trigger("focus").val(` || @${c.user.name} : ${e.reply_with_md?c.content:r(d).text()}`).trigger("input"),50)})})}}),e.source==="shy"&&(_.feedPage++,r("#feed-more").children("a").text("点击查看更多..."))):l()};let a=r(".feed-selector");r('<li class="feed-selector" id="exlg-benben-selector" data-mode="all-exlg" exlg="exlg"><a style="cursor: pointer">全网动态</a></li>').appendTo(a.parent()).on("click",i=>{let s=r(i.currentTarget);a.removeClass("am-active"),s.addClass("am-active"),e.source==="o2"&&r("#feed-more").hide(),_.feedPage=1,_.feedMode="all-exlg",r("li.am-comment").remove(),_.loadFeed()})},`
`,"module");h.reg("benben-quickpost","CtrlEnter 发送犇犇","@/",null,()=>r("textarea").whenKey("CtrlEnter",()=>r("#feed-submit").trigger("click")),`
`,"module");h.reg_v2({name:"blog",info:"博客 ex",path:["@/blogAdmin/article/edit/.*","@/blogAdmin/article/new"],cate:"module"},null,e=>{e.onload({name:"format",info:"按照洛谷题解标准格式化"},{on:{ty:"boolean",dft:!0,info:["Enable format","显示格式化按钮"],migration:"format"},cloud:{ty:"boolean",dft:!0,info:["Enable cloud format","启用云格式化"],migration:!0}},({msto:t})=>{let o=r(".mp-editor-menu");o.append('<li data-v-6d5597b1="" class="mp-divider"><span data-v-6d5597b1="">|</span></li>'),o.append(r('<li data-v-6d5597b1=""></li>').append(r('<a data-v-6d5597b1="" title="自动排版" unslectable="on" class="exlg-format-btn"></a>').append('<i data-v-6d5597b1="" unslectable="on" class="fa fa-check"></i>'))),r(".exlg-format-btn").on("click",async()=>{let n=_.articleEditor.content;t.cloud?n=await G("https://exlgcs.jin-dan.site/autocorrect",{content:n}).data.data:(n=n.replaceAll(/([\u4e00-\u9fa5])([a-z])/igu,"$1 $2"),n=n.replaceAll(/([a-z])([\u4e00-\u9fa5])/igu,"$1 $2"),n=n.replaceAll(/([\u4e00-\u9fa5])(\$)/igu,"$1 $2"),n=n.replaceAll(/(\$)([\u4e00-\u9fa5])/igu,"$1 $2")),_.articleEditor.content=n})}),e.onload({name:"hotkeys",info:"编辑快捷键"},{on:{ty:"boolean",dft:!0,info:["Enable hotkeys","快捷键"],migration:"hotkeys"}},()=>{r(_).whenKey({CtrlB:()=>r("a[title='粗体']")[0].click(),CtrlI:()=>r("a[title='斜体']")[0].click(),CtrlShiftX:()=>r("a[title='删除线']")[0].click()})})});var Ae=".bb-rnkitm:nth-child(1)::marker{color:var(--lg-red);font-weight:900}.bb-rnkitm:nth-child(2)::marker{color:var(--lg-orange);font-weight:900}.bb-rnkitm:nth-child(3)::marker{color:var(--lg-yellow);font-weight:900}.bb-rnkitm>span{display:flex;flex-wrap:wrap}.bb-rnkitm>span>span{margin-left:auto}.bb-rnklst-span{font-size:1em;font-weight:400}";var ae={_:new Map,sto:null,reg:(e,t,o,n,l,a)=>{let i=z.alias("component")+e;return t=t.replaceAll(" ","_"),N[i]={ty:"object",lvs:{on:{ty:"boolean",dft:!0},...o}},ae._.set(e,{info:t,pre:n,styl:a}),(...s)=>l(...(o?[{msto:ae.sto[i]}]:[]).concat(s))},ready:()=>{for(let[e,t]of ae._.entries())t.styl&&GM_addStyle(t.styl),M(`Preparing component: ${e}`),t.pre&&t.pre({msto:ae.sto[z.alias("component")+e]})}},R=ae;var Oe="input[exlg-badge-register],select[exlg-badge-register]{outline:none;display:inline-block;width:auto;padding:.5em;line-height:1.2;color:#555;vertical-align:middle;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:0;-webkit-appearance:none;-webkit-transition:border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}input[exlg-badge-register][disabled]{cursor:not-allowed;background-color:#eee}input[exlg-badge-register]:focus{border:1px solid #3bb4f2}body{margin:0}.exlg-dialog-footer{bottom:0;position:absolute;right:0;padding:10px 6px}.exlg-dialog-container.container-show:hover>.exlg-dialog-btn{background:rgba(255,255,255,.8)}.exlg-dialog-btn{margin:0 4px;float:right;color:#666;min-width:75px;cursor:pointer;background:rgba(255,255,255,.2);padding:7px 10px;border:1px solid #ddd;border-radius:3px}.exlg-dialog-container.container-hide{opacity:0}.exlg-dialog-container.container-show:hover{background:rgba(250,250,250,.8);box-shadow:0 2px 8px #0006;opacity:1}.exlg-dialog-container{filter:blur(0);position:relative;opacity:.75;background:rgba(204,204,204,.2);width:500px;min-height:300px;border-radius:5px;margin:0 auto;box-shadow:0 2px 8px #00000040;font-size:16px;line-height:1.5;backdrop-filter:blur(20px)}.exlg-dialog-wrapper{position:fixed;left:0;top:0;background:rgba(0,0,0,0);width:100%;height:100%;align-items:center;display:table-cell;z-index:150}.exlg-dialog-header{height:auto;border-bottom:1px solid #eee;padding:11px 20px}.exlg-dialog-body{text-align:center;margin-bottom:50px;padding:20px 30px 10px;line-height:2}#header-right{position:absolute;width:30px;height:30px;border-radius:5px;background:rgba(0,0,0,0);color:red;right:10px;top:10px;text-align:center}";var Ne='<div class="exlg-dialog-wrapper" id="exlg-wrapper" style="display: none;"><div class="exlg-dialog-container container-hide" id="exlg-container"><div class="exlg-dialog-header"><strong id="exlg-dialog-title"></strong><div id="header-right" style="opacity: 0.5;"><svg class="icon" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5446"><path d="M512 128c-211.7 0-384 172.3-384 384s172.3 384 384 384 384-172.3 384-384-172.3-384-384-384z m0 717.4c-183.8 0-333.4-149.6-333.4-333.4S328.2 178.6 512 178.6 845.4 328.2 845.4 512 695.8 845.4 512 845.4zM651.2 372.8c-9.9-9.9-25.9-9.9-35.8 0L512 476.2 408.6 372.8c-9.9-9.9-25.9-9.9-35.8 0-9.9 9.9-9.9 25.9 0 35.8L476.2 512 372.8 615.4c-9.9 9.9-9.9 25.9 0 35.8 4.9 4.9 11.4 7.4 17.9 7.4s13-2.5 17.9-7.4L512 547.8l103.4 103.4c4.9 4.9 11.4 7.4 17.9 7.4s13-2.5 17.9-7.4c9.9-9.9 9.9-25.9 0-35.8L547.8 512l103.4-103.4c9.9-9.9 9.9-25.9 0-35.8z" p-id="5447"></path></svg></div></div><div class="exlg-dialog-body"><div id="exlg-dialog-content"></div><div class="exlg-dialog-footer"><button class="exlg-dialog-btn" btn-rnk="0"></button><button class="exlg-dialog-btn" btn-rnk="1"></button></div></div></div></div>';var j={},gt=R.reg("exlg-dialog-board","exlg 公告板",{animation_speed:{ty:"enum",dft:".4s",vals:["0s",".2s",".25s",".4s"],info:["Speed of Board Animation","启动消失动画速度"]},confirm_position:{ty:"enum",dft:"left",vals:["left","right"],info:["Position of Confirm Button","确定按钮相对位置"]}},({msto:e})=>{let t=!1,o=r(Ne).appendTo(r(document.body)).on("mouseup",()=>{t=!1}),[n,l,a,i]=["#exlg-container","#exlg-dialog-title","#exlg-dialog-content","#header-right"].map(d=>o.find(d)),[s,c]=(e.confirm_position==="right"?[0,1]:[1,0]).map(d=>o.find(`button[btn-rnk="${d}"]`));s.text("确定"),c.text("取消"),s.on("click",async()=>{(await j.action.onconfirm?.(j)??!0)&&j.hide_dialog(),j.resolve_result("confirmed")}),c.on("click",async()=>{(await j.action.oncancel?.(j)??!0)&&j.hide_dialog(),j.resolve_result("canceled")}),i.on("click",async()=>{(await j.action.onclose?.(j)??!0)&&j.hide_dialog(),j.resolve_result("closed")}),n.on("click",d=>d.stopPropagation()),n.on("mousedown",d=>(t=!0)&&d.stopPropagation()),e.animation_speed!=="0s"&&n.css("transition",e.animation_speed),j={dom:{$wrap:o,$cont:n,$head:l,$main:a,$close:i},wait_time:{"0s":0,".2s":100,".25s":250,".4s":400}[e.animation_speed],show_dialog(){this.dom.$wrap.css("display","flex"),setTimeout(()=>{this.dom.$cont.removeClass("container-hide").addClass("container-show")},50)},hide_dialog(){this.dom.$cont.addClass("container-hide").removeClass("container-show"),setTimeout(()=>this.dom.$wrap.hide(),this.wait_time)},resolve_result(d){this._resolve?.(d)},then(){return new Promise(d=>{this._resolve=d})}}},(e,t="",o="exlg 提醒您",n={},{width:l,min_height:a}={})=>(j.action=typeof n=="function"?{onconfirm:n}:n,j.dom.$head.html(o),j.dom.$main.html(t??"exlg 提醒您"),j.dom.$cont.css({"min-height":a??"300px",width:l??"500px"}),j.show_dialog(),j.action.onopen?.(j),j),Oe),S=gt;h.reg_board("search-user","用户查找",null,({$board:e})=>{e.html(`
        <h3>查找用户</h3>
        <div class="am-input-group am-input-group-primary am-input-group-sm">
            <input type="text" class="am-form-field" placeholder="例：kkksc03，可跳转站长主页" name="username" id="search-user-input">
        </div>
        <p>
            <button class="am-btn am-btn-danger am-btn-sm" id="search-user">跳转</button>
        </p>
    `);let t=r("#search-user"),o=()=>{t.prop("disabled",!0),r.get(`/api/user/search?keyword=${r("[name=username]").val().trim()}`,n=>{n.users[0]?location.href=`/user/${n.users[0].uid}`:(t.prop("disabled",!1),S("无法找到指定用户"))})};t.on("click",o),r("#search-user-input").whenKey("Enter",o)},`
`,"module");h.reg_board("benben-ranklist","犇犇龙王排行榜",{show:{ty:"boolean",dft:!0,info:["Show in default","是否默认展开"]}},({msto:e,$board:t})=>{t.html(`<h3 id="bb-rnklst-h2">犇犇排行榜 <span id="bb-rnklst-btn" class="bb-rnklst-span"> [<a>${e.show?"收起":"展开"}</a>]</span><span style="float: right;" class="bb-rnklst-span"> [<a id="refresh-bbrnk">刷新</a>]</span></h3><ol style="display: ${e.show?"block":"none"}" id="bb-rnklst"></ol>`);let o=t.find("#bb-rnklst"),n=t.find("#bb-rnklst-btn > a").on("click",()=>{e.show=!e.show,n.text(e.show?"收起":"展开"),o.toggle()}),l=()=>F({url:"https://bens.rotriw.com/ranklist?_contentOnly=1",onload(a){r(JSON.parse(a.response)).each((i,s)=>{r(`<li class="bb-rnkitm">
                    <span>
                        <a href="https://bens.rotriw.com/user/${s[2]}">${s[1]}</a>
                        <span>${s[0]} 条</span>
                    </span>
                </li>`).appendTo(o)})}});t.find("#refresh-bbrnk").on("click",()=>{o.html(""),l()}),l()},Ae,"module");h.reg("captcha","验证码自动填充",["@/discuss/.+","@/image"],null,()=>{let e=r("img[data-v-3e1b4641],#verify_img"),t=async()=>{let o=document.createElement("canvas");o.width=e[0].width,o.height=e[0].height,o.getContext("2d").drawImage(e[0],0,0);let n=r("input[placeholder$='验证码']")[0];n.value=await G("https://luogu-captcha-bypass.piterator.com/predict/",o.toDataURL("image/jpeg")).responseText,n.dispatchEvent(new Event("input"))};e.length?(e.click(),e[0].onload=t):r(document).on("focus","input[placeholder$='验证码']",()=>{e=r("#--swal-image-hosting-upload-captcha"),e[0].onload=t})},`
`,"module");var Pe=".exlg-copy{position:relative;display:inline-block;border:1px solid #3498db;border-radius:3px;background-color:#3498db00;color:#3498db;font-family:-apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Noto Sans,Noto Sans CJK SC,Noto Sans CJK,Source Han Sans,PingFang SC,Segoe UI,Microsoft YaHei,sans-serif;flex:none;outline:0;cursor:pointer;font-weight:400;line-height:1.5;text-align:center;vertical-align:middle;background:0 0;font-size:12px;padding:0 5px;margin-left:1px}.exlg-copy.exlg-copy-right{float:right}.exlg-copy:hover{background-color:#3498db1a}div.exlg-copied{background-color:#3498dbe6!important;color:#fff!important}div.exlg-copied.exlg-copied-fail{background-color:#db3434e6!important;color:#fff!important}.copy-btn{font-size:.8em;padding:0 5px}.lfe-form-sz-middle{font-size:.875em;padding:.313em 1em}.exlg-code-title{margin:0;font-family:inherit;font-size:1.125em;color:inherit}";var ze=`h3.exlg-code-title.exlg-beautified-cbex{margin-bottom:0!important;padding:.4rem .6rem .4rem 2rem;background-color:#eee;font-weight:700;border-top-left-radius:5px;border-top-right-radius:5px;padding-top:8px;margin-top:10px;box-shadow:0 2px 2px #00000024,0 1px 5px #0000001f,0 3px 1px -2px #0003}h3.exlg-code-title.exlg-beautified-cbex+pre[exlg-copy-code-block]{margin-top:0;border-bottom-left-radius:5px;border-bottom-right-radius:5px;border:1px solid #eee;box-shadow:0 2px 2px #00000024,0 1px 5px #0000001f,0 3px 1px -2px #0003;background-color:#fafafa}h3.exlg-code-title.exlg-beautified-cbex+pre>code.hljs[class]{font-family:Fira Code,Consolas,monospace;background:white;padding:.5em}h3.exlg-code-title.exlg-beautified-cbex>div.exlg-copy{color:#6c757d;border:0px solid #3498db;margin-left:1px;font-size:0;transition:background-color .3s;background-image:url("data:image/svg+xml;utf8,<svg class='icon' style='width: 1em;height: 1em;vertical-align: middle;fill: rgb(108, 117, 125);overflow: hidden;' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='2669'><path d='M661.333333 234.666667A64 64 0 0 1 725.333333 298.666667v597.333333a64 64 0 0 1-64 64h-469.333333A64 64 0 0 1 128 896V298.666667a64 64 0 0 1 64-64z m-21.333333 85.333333H213.333333v554.666667h426.666667v-554.666667z m191.829333-256a64 64 0 0 1 63.744 57.856l0.256 6.144v575.701333a42.666667 42.666667 0 0 1-85.034666 4.992l-0.298667-4.992V149.333333H384a42.666667 42.666667 0 0 1-42.368-37.674666L341.333333 106.666667a42.666667 42.666667 0 0 1 37.674667-42.368L384 64h447.829333z' p-id='2670'></path></svg>");height:20px;width:20px;padding:0}h3.exlg-code-title.exlg-beautified-cbex>div.exlg-copy:hover{background-color:#6c757d1a}h3.exlg-code-title.exlg-beautified-cbex>div.exlg-copied[class]{background-color:#6c757d00!important;background-image:url("data:image/svg+xml;utf8,<svg class='icon' style='width: 1em;height: 1em;vertical-align: middle;fill: rgb(70, 160, 240);overflow: hidden;' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='2669'><path d='M661.333333 234.666667A64 64 0 0 1 725.333333 298.666667v597.333333a64 64 0 0 1-64 64h-469.333333A64 64 0 0 1 128 896V298.666667a64 64 0 0 1 64-64z m-21.333333 85.333333H213.333333v554.666667h426.666667v-554.666667z m191.829333-256a64 64 0 0 1 63.744 57.856l0.256 6.144v575.701333a42.666667 42.666667 0 0 1-85.034666 4.992l-0.298667-4.992V149.333333H384a42.666667 42.666667 0 0 1-42.368-37.674666L341.333333 106.666667a42.666667 42.666667 0 0 1 37.674667-42.368L384 64h447.829333z' p-id='2670'></path></svg>")}h3.exlg-code-title.exlg-beautified-cbex>div.exlg-copied[class]:hover{background-color:#6c757d4d!important}h3.exlg-code-title.exlg-beautified-cbex>div.exlg-copied.exlg-copied-fail[class]{background-color:#6c757d00!important;background-image:url("data:image/svg+xml;utf8,<svg class='icon' style='width: 1em;height: 1em;vertical-align: middle;fill: rgb(219, 52, 52);overflow: hidden;' viewBox='0 0 1024 1024' version='1.1' xmlns='http://www.w3.org/2000/svg' p-id='2669'><path d='M661.333333 234.666667A64 64 0 0 1 725.333333 298.666667v597.333333a64 64 0 0 1-64 64h-469.333333A64 64 0 0 1 128 896V298.666667a64 64 0 0 1 64-64z m-21.333333 85.333333H213.333333v554.666667h426.666667v-554.666667z m191.829333-256a64 64 0 0 1 63.744 57.856l0.256 6.144v575.701333a42.666667 42.666667 0 0 1-85.034666 4.992l-0.298667-4.992V149.333333H384a42.666667 42.666667 0 0 1-42.368-37.674666L341.333333 106.666667a42.666667 42.666667 0 0 1 37.674667-42.368L384 64h447.829333z' p-id='2670'></path></svg>")}h3.exlg-code-title.exlg-beautified-cbex>div.exlg-copied.exlg-copied-fail[class]:hover{background-color:#6c757d4d!important}`;h.reg_hook_new("code-block-ex","代码块优化","@/.*",{copy_code_position:{ty:"enum",vals:["left","right"],dft:"left",info:["Copy Button Position","复制按钮对齐方式"]},beautify_code_block:{ty:"boolean",dft:!0,info:["Beautify Code Block","代码块美化"]},code_block_title:{ty:"string",dft:"源代码 - ${lang}",info:["Custom Code Title(with Language)","自定义代码块标题 - 限定语言"]},code_block_title_nolang:{ty:"string",dft:"源代码",info:["Custom Code Title(without Language)","自定义代码块标题 - 默认"]},copy_code_font:{ty:"string",dft:"'Fira Code', 'Fira Mono', Consolas",info:["Code Block Font","代码块字体"],strict:!0},cb_background_color:{ty:"string",dft:"white",info:["Code Block Background Color","代码块背景色(配合其他美化插件)"],strict:!0},max_show_lines:{ty:"number",dft:-1,min:-1,max:100,info:["Max Lines On Show","代码块最大显示行数"],strict:!0}},({msto:e,args:t})=>{let o=/\/record\/.*/.test(location.href),n={c:"C",cpp:"C++",pascal:"Pascal",python:"Python",java:"Java",javascript:"JavaScript",php:"PHP",latex:"LaTeX"},l=a=>{let i="undefined";return o?r(r(".value.lfe-caption")[0]).text():(a.attr("data-rendered-lang")?i=a.attr("data-rendered-lang"):a.attr("class")&&a.attr("class").split(" ").forEach(s=>{s.startsWith("language-")&&(i=s.slice(9))}),n[i])};t.attr("exlg-copy-code-block",""),t.each((a,i,s=r(i))=>{if(i.parentNode.className==="mp-preview-content"||i.parentNode.parentNode.className==="mp-preview-area")return;let c=o?s.children(".copy-btn"):r('<div class="exlg-copy">复制</div>').on("click",()=>{if(c.text()==="复制"){try{GM_setClipboard(s.text(),"text/plain")}catch(C){c.text("复制失败").toggleClass("exlg-copied").toggleClass("exlg-copied-fail"),setTimeout(()=>c.text("复制").toggleClass("exlg-copied").toggleClass("exlg-copied-fail"),800),M("复制到剪贴板失败，错误信息: ",C);return}c.text("复制成功").toggleClass("exlg-copied"),setTimeout(()=>c.text("复制").toggleClass("exlg-copied"),800)}}),d=s.children("code");e.copy_code_font&&d.css("font-family",e.copy_code_font||""),d.hasClass("hljs")||d.addClass("hljs").css("background",e.cb_background_color),c.addClass(`exlg-copy-${e.copy_code_position}`);let g=l(d),f=g?e.code_block_title.replace("${lang}",g):e.code_block_title_nolang,x=o?r(".lfe-h3").text(f):r(`<h3 class="exlg-code-title" style="/*width: 100%;*/">${f}</h3>`);e.beautify_code_block&&x.addClass("exlg-beautified-cbex"),o||s.before(x.append(c))})},e=>{let t=r(e.target).find("pre:has(> code:not(.cm-s-default)):not([exlg-copy-code-block])");return{result:t.length,args:t}},()=>r("pre:has(> code:not(.cm-s-default)):not([exlg-copy-code-block])"),Pe+ze,"module");var De='<div class="exlg-unselectable exlg-badge-page" style="font-family: Consolas;white-space: nowrap;text-align: left;"><div class="container"><div class="exlg-regbadge-box"><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">uid</span><input key="uid" exlg-badge-register type="text" style="padding: .1em;" placeholder="填写用户名或uid" value="" disabled title="暂不支持为别人注册 badge"/></span><br/><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">激活码</span><input key="active" exlg-badge-register type="text" style="padding: .1em;"/></span><br/><small style="margin-left: 2px;" extraMessage="怎么有人连预览里是个输入框都看不出来哇"><strong>提示：</strong> 请在预览处点击 badge 以编辑内容。</small><br/><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">模式</span><select id="regbadge-type-select" exlg-badge-register type="select" style="padding: .1em;padding-right: 20px;width: auto;display: inline;"><option value="3">luogu3(default)</option><option value="4">luogu4</option></select></span><br/><span style="margin: 5px;"><span style="height: 1.5em;float: left;padding: .1em;width: 5em;"> </span><span style="float: left;margin-left: 5px;"><button id="regbadge-button-recoverall">还原默认设置</button><br/><button id="regbadge-button-recover43">覆盖为洛谷 3 设置</button><br/><button id="regbadge-button-exportJSON">导出配置</button><button id="regbadge-button-importJSON">导入配置</button></span></span></div><div class="exlg-regbadge-box" id="regbadge-settings"><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">背景</span><span class="exlg-bg-colset" style="float: right;margin-right: 3em;"></span><input key="bg" css-key="background" exlg-badge-register type="text" style="padding: .1em;" placeholder="mediumturquoise" value=""/></span><br/><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">前景</span><span class="exlg-fg-colset" style="float: right;margin-right: 3em;"></span><input key="fg" css-key="color" exlg-badge-register type="text" style="padding: .1em;" placeholder="#fff" value=""/></span><br/><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">边框</span><input key="bd" css-key="border" exlg-badge-register type="text" style="padding: .1em;" placeholder="" value=""/></span><br/><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">字体</span><input key="ft" css-key="font-family" exlg-badge-register type="text" style="padding: .1em;" placeholder="" value=""/></span><br/><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">字号</span><input key="fs" css-key="font-size" exlg-badge-register type="text" style="padding: .1em;" placeholder="" value=""/></span><br/><span style="margin: 5px;"><span class="exlg-regbadge-fronttitle">字粗</span><input key="fw" css-key="font-weight" exlg-badge-register type="text" style="padding: .1em;" placeholder="700" value=""/></span></div><div id="regbadge-preview-container" style="width: 100%;display: flex;"><span style="height: 1.5em;float: left;padding: .1em;width: 5em;">预览</span><span id="regbadge-preview"><span><a id="regbadge-preview-id">nya!</a><span class="preview-ccf-tag"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="margin-bottom: -3px;"><path d="M16 8C16 6.84375 15.25 5.84375 14.1875 5.4375C14.6562 4.4375 14.4688 3.1875 13.6562 2.34375C12.8125 1.53125 11.5625 1.34375 10.5625 1.8125C10.1562 0.75 9.15625 0 8 0C6.8125 0 5.8125 0.75 5.40625 1.8125C4.40625 1.34375 3.15625 1.53125 2.34375 2.34375C1.5 3.1875 1.3125 4.4375 1.78125 5.4375C0.71875 5.84375 0 6.84375 0 8C0 9.1875 0.71875 10.1875 1.78125 10.5938C1.3125 11.5938 1.5 12.8438 2.34375 13.6562C3.15625 14.5 4.40625 14.6875 5.40625 14.2188C5.8125 15.2812 6.8125 16 8 16C9.15625 16 10.1562 15.2812 10.5625 14.2188C11.5938 14.6875 12.8125 14.5 13.6562 13.6562C14.4688 12.8438 14.6562 11.5938 14.1875 10.5938C15.25 10.1875 16 9.1875 16 8ZM11.4688 6.625L7.375 10.6875C7.21875 10.8438 7 10.8125 6.875 10.6875L4.5 8.3125C4.375 8.1875 4.375 7.96875 4.5 7.8125L5.3125 7C5.46875 6.875 5.6875 6.875 5.8125 7.03125L7.125 8.34375L10.1562 5.34375C10.3125 5.1875 10.5312 5.1875 10.6562 5.34375L11.4688 6.15625C11.5938 6.28125 11.5938 6.5 11.4688 6.625Z"></path></svg></span><span id="preview-lg-badge"></span></span><span class="exlg-badge-preview"><input style="width: 4px;"/></span><br><span fuck="o2" style="opacity: 0;position: fixed;"></span></span></div></div></div>';var Ie='#regbadge-preview .exlg-badge-preview{border:none}#regbadge-preview input{border:none;background:0 0;outline:0}textarea.exlg-regbadge-configinput{display:block;width:100%;padding:.5em;line-height:1.2;color:#555;outline:0;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:0;-webkit-appearance:none;-webkit-transition:border-color .15s ease-in-out,-webkit-box-shadow .15s ease-in-out;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}textarea.exlg-regbadge-configinput:hover{background-color:#fefffe;border-color:#3bb4f2;outline:0;-webkit-box-shadow:inset 0 1px 1px rgb(0 0 0 / 8%),0 0 5px rgb(59 180 242 / 30%);box-shadow:inset 0 1px 1px #00000014,0 0 5px #3bb4f24d}#regbadge-preview-id{font-family:apple-system,BlinkMacSystemFont,San Francisco,Helvetica Neue,Noto Sans CJK SC,Noto Sans CJK,Source Han Sans,PingFang SC,Microsoft YaHei,sans-serif}#preview-lg-badge>.lg3-badge{text-align:center;box-sizing:border-box;display:inline-block;min-width:10px;padding:.25em .625em;font-size:1.2rem;font-weight:700;color:#fff;line-height:1;vertical-align:baseline;white-space:nowrap;border-radius:2px}#preview-lg-badge>.lg4-badge{color:#fff;display:inline-block;padding:0 8px;box-sizing:border-box;font-weight:400;line-height:1.5;border-radius:2px;margin-left:.2em;font-size:.875em}.exlg-badge-page .exlg-regbadge-box{width:50%;float:left;display:inline}.exlg-badge-page .exlg-regbadge-fronttitle{height:1.5em;float:left;padding:.1em;width:5em}.exlg-badge-page button{color:#666;min-width:75px;cursor:pointer;background:rgba(255,255,255,.2);padding:3px 10px;border:1px solid #ddd;border-radius:3px}select[exlg-badge-register]{background:url("data:image/svg+xml;charset=UTF-8, %3Csvg%20style=%22fill:%20rgb(108,%20117,%20125);%22%20width=%2210%22%20height=%2210%22%20viewBox=%220%200%209%209%22%20fill=%22rgb(108,%20117,%20125)%22%20xmlns=%22http://www.w3.org/2000/svg%22%20class=%22link-icon--right%22%3E%3Cpath%20fill-rule=%22evenodd%22%20clip-rule=%22evenodd%22%20d=%22M7.50588%203.40623C7.40825%203.3086%207.24996%203.3086%207.15232%203.40623L4.41244%206.14612L1.67255%203.40623C1.57491%203.3086%201.41662%203.3086%201.31899%203.40623C1.22136%203.50386%201.22136%203.66215%201.31899%203.75978L4.11781%206.5586C4.28053%206.72132%204.54434%206.72132%204.70706%206.5586L7.50588%203.75978C7.60351%203.66215%207.60351%203.50386%207.50588%203.40623Z%22%20fill=%22rgb(108,%20117,%20125)%22%3E%3C/path%3E%3Cpath%20d=%22M7.15232%203.40623L7.50588%203.75978L7.50588%203.75978L7.15232%203.40623ZM7.50588%203.40623L7.15232%203.75978L7.15233%203.75978L7.50588%203.40623ZM4.41244%206.14612L4.05888%206.49967C4.15265%206.59344%204.27983%206.64612%204.41244%206.64612C4.54504%206.64612%204.67222%206.59344%204.76599%206.49967L4.41244%206.14612ZM1.67255%203.40623L2.0261%203.05268L2.0261%203.05268L1.67255%203.40623ZM1.31899%203.40623L0.965439%203.05268L0.965439%203.05268L1.31899%203.40623ZM1.31899%203.75978L1.67255%203.40623V3.40623L1.31899%203.75978ZM4.11781%206.5586L3.76425%206.91215L4.11781%206.5586ZM4.70706%206.5586L4.35351%206.20505L4.70706%206.5586ZM7.50588%203.75978L7.15233%203.40623L7.15232%203.40623L7.50588%203.75978ZM7.50588%203.75978C7.40825%203.85742%207.24996%203.85742%207.15232%203.75978L7.85943%203.05268C7.56654%202.75978%207.09166%202.75978%206.79877%203.05268L7.50588%203.75978ZM4.76599%206.49967L7.50588%203.75978L6.79877%203.05268L4.05888%205.79257L4.76599%206.49967ZM1.31899%203.75978L4.05888%206.49967L4.76599%205.79257L2.0261%203.05268L1.31899%203.75978ZM1.67254%203.75979C1.57491%203.85742%201.41662%203.85742%201.31899%203.75979L2.0261%203.05268C1.73321%202.75978%201.25833%202.75978%200.965439%203.05268L1.67254%203.75979ZM1.67255%203.40623C1.77018%203.50386%201.77018%203.66215%201.67255%203.75978L0.965439%203.05268C0.672546%203.34557%200.672546%203.82044%200.965439%204.11334L1.67255%203.40623ZM4.47136%206.20505L1.67255%203.40623L0.965439%204.11334L3.76425%206.91215L4.47136%206.20505ZM4.35351%206.20505C4.38605%206.1725%204.43882%206.1725%204.47136%206.20505L3.76425%206.91215C4.12223%207.27013%204.70264%207.27013%205.06062%206.91215L4.35351%206.20505ZM7.15232%203.40623L4.35351%206.20505L5.06062%206.91215L7.85943%204.11334L7.15232%203.40623ZM7.15233%203.75978C7.05469%203.66215%207.05469%203.50386%207.15233%203.40623L7.85943%204.11334C8.15233%203.82045%208.15233%203.34557%207.85943%203.05268L7.15233%203.75978Z%22%20fill=%22rgb(108,%20117,%20125)%22%3E%3C/path%3E%3C/svg%3E") right no-repeat;background-size:auto}';var p={},ye=R.reg("register-badge","badge 注册",null,null,(e=null)=>{try{(0,eval)(GM_getResourceText("colorpicker")),M("这个页面可以用 eval 的说！芜湖，起飞~")}catch(o){M("这个页面并不可以用 eval (悲"),S("这个页面不可以用 eval 哇，能不能...试一下其他页面的说...<br/>可以吗可以吗可以吗~<br/> - 诶诶诶诶诶不可以？??!<br/>呜哇~达咩！<br/><small>(选项一：[确定] “*诶呦我操，这是好的*”)<br/>(选项二：[取消] *你够了，我无法忍受，你的行为*)&nbsp;</small>","来自 exlg 娘的提示！",()=>location.href=location.origin),Z("错误信息: ",o);return}let t="exlg badge register ver.7.0: 暂不可用";S(De,t,{onconfirm:async()=>{p.dom.$title.html("获取并验证令牌..."),h.execute("token");let o={text:p.dom.$text_input[0].value};Object.assign(o,p.parse_data);let n={uid:p.dom.$uid[0].value,token:E["^token"].token,data:o};if(p.isactive||(n.activation=p.dom.$act.val()),!n.data.text)return p.gerr("[Err] 请填写 badge"),!1;p.dom.$title.html("请求中...");let l=await G("https://exlg.piterator.com/badge/set",n).data;if("error"in l)p.dom.$title.html("[Err] 失败"),S(`<div style="margin-bottom: 1.5em;">
                <div><strong style="color: red;">错误信息:</strong></div>
                <div>${l.error}</div>
            </div>
            <small>点击确定以返回。</small>`,"激活 badge 出错",()=>(ye(p.parse_data),!1));else{let a=Object.assign(JSON.parse(E["sponsor-tag"].badges),l.data);a[n.uid].ts=B(),E["sponsor-tag"].badges=JSON.stringify(a),p.dom.$title.html("成功"),S("badge 激活成功！感谢您对 exlg 的<del>打钱</del>支持。","badge 激活成功",()=>{location.reload()})}return!1},onopen:()=>{let o={Purple:["#8e44ad","rgb(157, 61, 207)"],Red:["#e74c3c","rgb(254, 76, 97)"],Orange:["#e67e22","rgb(243, 156, 17)"],Green:["#5eb95e","rgb(82, 196, 26)"],Blue:["#0e90d2","rgb(52, 152, 219)"],Gray:["#bbb","rgb(191, 191, 191)"],Cheater:["#996600","rgb(173, 139, 0)"]},n=r("#exlg-container"),l=n.find("#exlg-dialog-title");p.gerr=(i,s=1500)=>{l.html(i),setTimeout(()=>l.html(t),s)},p.dom={$title:"#exlg-dialog-title",$uid:"input[key='uid']",$act:"input[key='active']",$prvid:"#regbadge-preview-id",$ccf:".preview-ccf-tag",$type:"select",$lgbg:"#preview-lg-badge",$exlg_badge_prev:".exlg-badge-preview",$text_input:"#regbadge-preview input",$text_test:"#regbadge-preview span[fuck=o2]",btn:{}},Object.keys(p.dom).forEach(i=>p.dom[i]=i.includes("$")?n.find(p.dom[i]):p.dom[i]),p.current_type=3,p.refreshInputData=()=>{Object.keys(p.customSettings).forEach(i=>p.customSettings[i].refreshData(p.current_type))},p.customSettings={},p.parse_data={lg4:{}},n.find("input[key][css-key]").each((i,s)=>{let c=s.getAttribute("key");p.customSettings[c]={key:c,csskey:s.getAttribute("css-key"),jsdom:s,jqdom:r(s),defaultvalue:s.placeholder,setData(d=p.current_type){(d&1?p.parse_data:p.parse_data.lg4)[this.key]=this.jsdom.value,this.jsdom.value&&this.jsdom.value===(d&1?this.defaultvalue:p.parse_data[c]||this.defaultvalue)&&delete(d&1?p.parse_data:p.parse_data.lg4)[this.key],d&1&&Object.keys(p.parse_data.lg4).includes(this.key)&&p.parse_data.lg4[this.key]===p.parse_data[this.key]&&delete p.parse_data.lg4[this.key]},refreshData(d=p.current_type){this.jsdom.value=p.parse_data[this.key]||"",d>3&&(this.jsdom.value=p.parse_data.lg4[this.key]||this.jsdom.value),this.colorpicker&&this.colorpicker.refreshPicker()},resetHolder(d=p.current_type){d&1?this.jsdom.placeholder=this.defaultvalue:this.jsdom.placeholder=p.parse_data[c]||this.defaultvalue}},r(s).on("input",()=>{p.customSettings[c].setData(p.current_type),p.customSettings[c].colorpicker&&p.customSettings[c].colorpicker.refreshPicker(),p.updatePreview()})}),n.find(".exlg-badge-page button").each((i,s)=>{p.dom.btn[s.id.slice(16)]=s}),r(p.dom.btn.recoverall).on("click",()=>{p.parse_data={lg4:{}},p.refreshInputData(),p.updatePreview(),p.gerr("已清空所有设置选项至默认值")}),r(p.dom.btn.recover43).on("click",()=>{if(p.dom.$type.val()===3)return p.gerr("处于 luogu3 编辑模式，操作无效");p.parse_data.lg4={},p.refreshInputData(),p.updatePreview(),p.gerr("成功以 luogu3 覆盖 luogu4 设置")}),r(p.dom.btn.exportJSON).on("click",()=>{let i={};try{i=JSON.stringify({text:p.dom.$text_input[0].value,...p.parse_data}),i.lg4&&i.lg4.text&&delete i.lg4.text}catch(s){p.gerr("导出配置 json 失败"),Z("导出配置 json 失败，错误信息: ",s);return}try{GM_setClipboard(i,"text/plain")}catch(s){p.gerr("复制至剪贴板失败"),Z("复制到剪贴板失败，错误信息: ",s);return}p.gerr("成功复制 json 配置信息至剪贴板")}),r(p.dom.btn.importJSON).on("click",()=>{let i=p.parse_data;S(`<textarea class="exlg-regbadge-configinput" rows="8" style="font-family: 'Fira Code', 'Fira Mono', Consolas;"></textarea>`,"请输入 json 配置",{onconfirm:()=>{let s=r("textarea.exlg-regbadge-configinput").val(),c=null;try{if(c=JSON.parse(s),typeof c!="object")throw new TypeError("obj are expected to be an object.")}catch(d){return M("无法正确解析配置: ",d),r("#exlg-dialog-title").html("无法正确解析配置"),setTimeout(()=>r("#exlg-dialog-title").html("请输入 json 配置"),1500),r("textarea.exlg-regbadge-configinput").val(""),!1}return ye(c),!1},onopen:()=>{r("textarea.exlg-regbadge-configinput").val(JSON.stringify(i))}})}),p.dom.$type.on("change",()=>{p.current_type=p.dom.$type.val(),Object.keys(p.customSettings).forEach(i=>{p.customSettings[i].resetHolder(),_.hsrd=p}),p.refreshInputData(),p.updatePreview()}),p.recalcInputWidth=()=>{p.dom.$text_test.text(p.dom.$text_input[0].value),p.dom.$text_input.css("width",p.dom.$text_test[0].offsetWidth+4)},L?.uid&&!p.dom.$uid[0].value&&(p.dom.$uid[0].value=L.uid),p.dom.$text_input.on("input",p.recalcInputWidth),p.updatePreview=()=>{let i=["Red","Orange","Purple","Cheater"];p.dom.$prvid.removeAttr("style").text(L.name),(p.current_type===4||i.includes(L.color))&&p.dom.$prvid.css("font-weight","bold"),p.dom.$prvid.css("color",o[L.color][p.current_type-3]),[{l:[0,1,2],r:"display: none;"},{l:[3,4,5],r:"fill: #5eb95e;"},{l:[6,7],r:"fill: #3498db;"},{l:[8,9,10],r:"fill: #f1c40f;"}].forEach(s=>{s.l.includes(L.ccfLevel)&&(p.dom.$ccf[0].style=s.r)}),L.badge?p.dom.$lgbg.html(`<span class="lg${p.current_type}-badge" style="background-color: ${o[L.color][p.current_type-3]};">${L.badge}</span>`).show():p.dom.$lgbg.hide(),p.dom.$exlg_badge_prev.attr("style",`
                    border-radius: 50px;
                    padding-left: 10px;
                    padding-right: 10px;
                    padding-top: 4px;
                    padding-bottom: 4px;
                    transition: all .15s;
                    display: inline-block;
                    min-width: 10px;
                    font-size: 1em;
                    font-weight: 700;
                    line-height: 1;
                    vertical-align: baseline;
                    white-space: nowrap;
                    cursor: pointer;
                    margin-left: 2px;
                    margin-right: 2px;
                `),Object.keys(p.customSettings).forEach((s,c)=>{let d=p.customSettings[s],g=p.current_type&1?p.parse_data[s]||d.defaultvalue:p.parse_data.lg4[s]||p.parse_data[s]||d.defaultvalue;s==="bg"&&(g=g.replaceAll("${luogu-default}",o[L.color][p.current_type-3])),p.dom.$exlg_badge_prev.css(d.csskey,g)}),["minWidth","fontSize","fontWeight","whiteSpace"].forEach(s=>{p.dom.$text_test[0].style[s]=p.dom.$exlg_badge_prev[0].style[s]}),p.recalcInputWidth()};let a=JSON.parse(E["sponsor-tag"].badges)[L.uid];typeof a<"u"&&typeof a.text<"u"?(p.dom.$text_input[0].value=a.text,delete a.text,e===null&&Object.assign(p.parse_data,a),p.dom.$act.val("已激活").attr("disabled",""),p.isactive=!0):p.isactive=!1,e!==null&&(e.text=e.text??"",Object.assign(p.parse_data,e),p.dom.$text_input[0].value=e.text),r("input[key='bg'][css-key], input[key='fg'][css-key]").each((i,s,c=r(s))=>c.on("input",()=>{s.value=s.value.replaceAll("to top","0deg").replaceAll("to right","90deg").replaceAll("to bottom","180deg").replaceAll("to left","270deg").replaceAll("to top right","45deg").replaceAll("to right top","45deg").replaceAll("to bottom right","135deg").replaceAll("to right bottom","135deg").replaceAll("to bottom left","225deg").replaceAll("to left bottom","225deg").replaceAll("to top left","315deg").replaceAll("to left top","315deg")})),p.refreshInputData(),p.updatePreview(),[{selector:".exlg-bg-colset",defaultColor:"mediumturquoise",id:"bg"},{selector:".exlg-fg-colset",defaultColor:"#fff",id:"fg"}].forEach(i=>{let s=p.customSettings[i.id].jsdom,c=()=>{let g=s.value||s.placeholder;return i.id==="bg"&&(g=g.replaceAll("${luogu-default}",o[L.color][p.current_type-3])),g},d=new XNColorPicker({color:c()??i.defaultColor,selector:i.selector,colorTypeOption:"single,linear-gradient,radial-gradient",onError:()=>{},onCancel:()=>{},onChange:()=>{},onConfirm:g=>{let f=g.colorType==="single"?g.color.hex:g.color.str;p.customSettings[i.id].jsdom.value=f,p.customSettings[i.id].setData(),p.updatePreview()}});d.getColorString=c,d.refreshPicker=function(){this.setColor(this.getColorString())},p.customSettings[i.id].colorpicker=d})}},{width:"800px",min_height:"400px"})},Ie),te=ye;var ht=R.reg("get-latest","获取最新版本",{fetch_preview:{ty:"boolean",dft:!1,info:["Update preview versions","预览版更新"]}},null,({msto:e})=>new Promise((t,o)=>{F({url:`https://api.github.com/repos/extend-luogu/extend-luogu/releases${e.fetch_preview?"?per_page=1":"/latest"}`,onload:n=>{let l=JSON.parse(n.responseText),a=(Array.isArray(l)?l[0]:l).tag_name,{version:i}=GM_info.script,s=K(i,a),c=`Comparing version: ${i} ${s} ${a}`;M(c),t([a,s])},onerror:n=>{O(n),o(n)}})})),ge=ht;var Ze='#exlg-dash{margin-right:5px;position:relative;display:inline-block;padding:1px 10px 3px;color:#fff;border-radius:6px;box-shadow:0 0 7px #1e90ff;cursor:pointer}#exlg-dash>.exlg-warn{position:absolute;top:-.5em;right:-.5em}.exlg-icon:before{display:inline-block;width:1.3em;height:1.3em;margin-left:3px;text-align:center;border-radius:50%}.exlg-icon:hover:after{display:inline-block}.exlg-icon:after{display:none;content:attr(name);margin-left:5px;padding:0 3px;background-color:#fff;box-shadow:0 0 7px #00bfff;border-radius:7px}.exlg-icon.exlg-info:before{content:"i";color:#fff;background-color:#00bfff;font-style:italic}.exlg-icon.exlg-warn:before{content:"!";color:#fff;background-color:#e74c3c;font-style:normal}.exlg-unselectable{-webkit-user-select:none;-moz-user-select:none;-o-user-select:none;user-select:none}:root{--exlg-azure: #7bb8eb;--exlg-aqua: #03a2e8;--exlg-indigo: #3f48cb;--std-mediumturquoise: #48d1cc;--std-cornflowerblue: #6495ed;--std-dodgerblue: #1e90ff;--std-white: #fff;--std-black: #000;--lg-gray: #bbb;--lg-gray-2: #7f7f7f;--lg-gray-3: #6c757d;--lg-gray-4: #414345;--lg-gray-5: #333;--lg-gray-6: #000000bf;--lg-blue: #3498db;--lg-blue-button: #0e90d2;--lg-blue-dark: #34495e;--lg-blue-2: #7cb5ecbf;--lg-green: #5eb95e;--lg-green-dark: #054310c9;--lg-green-light: #5eb95e26;--lg-green-light-2: #c9e7c9;--lg-yellow: #f1c40f;--lg-orange: #e67e22;--lg-red: #e74c3c;--lg-red-light: #dd514c26;--lg-red-light-2: #f5cecd;--lg-red-button: #dd514c;--lg-purple: #8e44ad;--argon-indigo: #5e72e4;--argon-red: #f80031;--argon-red-button: #f5365c;--argon-green: #1aae6f;--argon-green-button: #2dce89;--argon-cyan: #03acca;--argon-yellow: #ff9d09;--lg-red-problem: #fe4c61;--lg-orange-problem: #f39c11;--lg-yellow-problem: #ffc116;--lg-green-problem: #52c41a;--lg-blue-problem: #3498db;--lg-purple-problem: #9d3dcf;--lg-black-problem: #0e1d69;--lg-gray-problem: #bfbfbf}.exlg-difficulty-color{font-weight:700}.exlg-difficulty-color.color-0{color:#bfbfbf!important}.exlg-difficulty-color.color-1{color:#fe4c61!important}.exlg-difficulty-color.color-2{color:#f39c11!important}.exlg-difficulty-color.color-3{color:#ffc116!important}.exlg-difficulty-color.color-4{color:#52c41a!important}.exlg-difficulty-color.color-5{color:#3498db!important}.exlg-difficulty-color.color-6{color:#9d3dcf!important}.exlg-difficulty-color.color-7{color:#0e1d69!important}#exlg-dash-wrapper:hover>.exlg-window{visibility:visible;opacity:1;transition-delay:unset}#exlg-dash-wrapper>.exlg-window{position:absolute;top:35px;left:0;z-index:148;visibility:hidden;opacity:0;width:340px;padding:15px;background:white;color:#000;border-radius:7px;box-shadow:#bbe3ff 0 0 7px;transition:.233s ease all}.exlg-window{position:absolute;top:35px;left:0;width:340px;padding:15px;z-index:6;background:white;color:#000;border-radius:7px;box-shadow:#bbe3ff 0 0 7px;transition:.233s ease all}.exlg-windiv-left-tag{height:2em;width:18%;margin-right:10px;display:inline-block;text-align:center}.exlg-windiv-btn{font-size:.9em;display:inline-block;flex:none;outline:0;cursor:pointer;color:#fff;font-weight:inherit;line-height:1.5;text-align:center;vertical-align:middle;background:0 0;border-radius:5px;border:1px solid;margin:4px}.dropdown>.center{padding:4px 1px 10px}';var Re="#exlg-dash{padding:3px 19px 4px;box-shadow:0 2px 5px #0009;font-family:Fira Code,Fira Mono,Consolas}#exlg-dash-window[class=exlg-window]{box-shadow:0 3px 8px #0009;font-family:Fira Code,Fira Mono,Consolas;padding:10px;width:400px!important;left:-175px!important;background:rgba(255,255,255,.6);backdrop-filter:blur(12px);margin-top:10px}#exlg-windiv,#exlg-dash-window>h2{padding:5px}#exlg-dash-window>h2 g{fill:#3f48cc}.exlg-windiv-btn{background-color:#3f48cc!important;border:none!important;padding:.313em 1em}.exlg-windiv-btn:hover{background-color:#607ee8!important;transition:background-color .25s}#link-div .exlg-windiv-btnspan:nth-child(2) svg{fill:#fff;padding-right:3px;height:16px;width:16px;line-height:1.5}";var ve='.ops>a.color-none{width:auto;display:flex;align-items:center;justify-content:space-between;padding:6px 14px;border-radius:8px;color:var(--text2);font-size:14px;cursor:pointer;transition:background-color .3s;margin:2px}.ops>a.color-none:hover{background-color:#e3e5e7}.ops>a.color-none>.link-title{display:flex;align-items:center}.ops>a.color-none>.link-title>svg{margin-right:8px;width:16px}.ops>a.color-none:after{transform:rotate(-90deg);content:url("data:image/svg+xml;charset=UTF-8, %3Csvg%20style=%22fill:%20rgb(108,%20117,%20125);%22%20width=%2210%22%20height=%2210%22%20viewBox=%220%200%209%209%22%20fill=%22rgb(108,%20117,%20125)%22%20xmlns=%22http://www.w3.org/2000/svg%22%20class=%22link-icon--right%22%3E%3Cpath%20fill-rule=%22evenodd%22%20clip-rule=%22evenodd%22%20d=%22M7.50588%203.40623C7.40825%203.3086%207.24996%203.3086%207.15232%203.40623L4.41244%206.14612L1.67255%203.40623C1.57491%203.3086%201.41662%203.3086%201.31899%203.40623C1.22136%203.50386%201.22136%203.66215%201.31899%203.75978L4.11781%206.5586C4.28053%206.72132%204.54434%206.72132%204.70706%206.5586L7.50588%203.75978C7.60351%203.66215%207.60351%203.50386%207.50588%203.40623Z%22%20fill=%22rgb(108,%20117,%20125)%22%3E%3C/path%3E%3Cpath%20d=%22M7.15232%203.40623L7.50588%203.75978L7.50588%203.75978L7.15232%203.40623ZM7.50588%203.40623L7.15232%203.75978L7.15233%203.75978L7.50588%203.40623ZM4.41244%206.14612L4.05888%206.49967C4.15265%206.59344%204.27983%206.64612%204.41244%206.64612C4.54504%206.64612%204.67222%206.59344%204.76599%206.49967L4.41244%206.14612ZM1.67255%203.40623L2.0261%203.05268L2.0261%203.05268L1.67255%203.40623ZM1.31899%203.40623L0.965439%203.05268L0.965439%203.05268L1.31899%203.40623ZM1.31899%203.75978L1.67255%203.40623V3.40623L1.31899%203.75978ZM4.11781%206.5586L3.76425%206.91215L4.11781%206.5586ZM4.70706%206.5586L4.35351%206.20505L4.70706%206.5586ZM7.50588%203.75978L7.15233%203.40623L7.15232%203.40623L7.50588%203.75978ZM7.50588%203.75978C7.40825%203.85742%207.24996%203.85742%207.15232%203.75978L7.85943%203.05268C7.56654%202.75978%207.09166%202.75978%206.79877%203.05268L7.50588%203.75978ZM4.76599%206.49967L7.50588%203.75978L6.79877%203.05268L4.05888%205.79257L4.76599%206.49967ZM1.31899%203.75978L4.05888%206.49967L4.76599%205.79257L2.0261%203.05268L1.31899%203.75978ZM1.67254%203.75979C1.57491%203.85742%201.41662%203.85742%201.31899%203.75979L2.0261%203.05268C1.73321%202.75978%201.25833%202.75978%200.965439%203.05268L1.67254%203.75979ZM1.67255%203.40623C1.77018%203.50386%201.77018%203.66215%201.67255%203.75978L0.965439%203.05268C0.672546%203.34557%200.672546%203.82044%200.965439%204.11334L1.67255%203.40623ZM4.47136%206.20505L1.67255%203.40623L0.965439%204.11334L3.76425%206.91215L4.47136%206.20505ZM4.35351%206.20505C4.38605%206.1725%204.43882%206.1725%204.47136%206.20505L3.76425%206.91215C4.12223%207.27013%204.70264%207.27013%205.06062%206.91215L4.35351%206.20505ZM7.15232%203.40623L4.35351%206.20505L5.06062%206.91215L7.85943%204.11334L7.15232%203.40623ZM7.15233%203.75978C7.05469%203.66215%207.05469%203.50386%207.15233%203.40623L7.85943%204.11334C8.15233%203.82045%208.15233%203.34557%207.85943%203.05268L7.15233%203.75978Z%22%20fill=%22rgb(108,%20117,%20125)%22%3E%3C/path%3E%3C/svg%3E")}.ops>a:hover{background-color:#e3e5e7;border-radius:1em}.wrapper.hover>.dropdown>.center{font-size:1.1em}.exlg-dropdown.field{display:inline-block;border-left:none;padding:0 .8em}.exlg-dropdown.field:hover{color:#00aeec!important}.exlg-dropdown.field:hover>.value{color:#00aeec!important}.exlg-dropdown.field:hover>.key{color:#00aeec!important}.exlg-dropdown.field>.value{display:block;text-align:center;line-height:1.5;font-weight:700;color:#6c757d;font-size:1.1em;transition:color .2s}.exlg-dropdown.field>.key{display:block;text-align:center;color:#9499a0;font-weight:400;font-size:.75em;transition:color .2s}.exlg-dropdown.field>.key-small{display:block;text-align:center;color:#9499a0;font-weight:400;font-size:.5em;transition:color .2s}.ops[data-v-78704ac9]{padding:.5em .9em}.header[data-v-78704ac9]{margin-bottom:-.6em}';h.reg_main("dash-board","控制面板",h.path_dash_board,{msg:{ty:"object",priv:!0,lvs:{queue:{ty:"array",itm:{ty:"object",lvs:{text:{ty:"string"},id:{ty:"number"}}}},last_id:{ty:"number",dft:0}}},lang:{ty:"enum",dft:"zh",vals:["zh","en"],info:["Language of descriptions in the dashboard","控制面板提示语言"]}},()=>{let e=(o,n=[])=>Object.entries(o).filter(([l,a])=>(n.length||l!=="on")&&!a.priv).flatMap(([l,a])=>a.ty==="object"?e(a.lvs,n.concat(l)):{name:n.concat(l),displayName:l.split("_").map(i=>i.toInitialCase()).join(" "),description:a.info,type:{number:"SLIDER",boolean:"CHECKBOX",string:"TEXTBOX",enum:"SELECTBOX"}[a.ty],...a.ty==="number"&&{minValue:a.min,maxValue:a.max,increment:a.step},...a.ty==="enum"&&{acceptableValues:a.vals}}),t=[...z._].map(([o,{description:n,alias:l,icon:a,unclosable:i}])=>({name:o,description:n,icon:a,children:(o==="component"?[...R._]:[...h._].filter(([,s])=>s.cate===o)).map(([s,c])=>({rawName:l+s,name:s,description:c.info,unclosable:i,settings:e(N[l+s]?.lvs??{})}))}));console.log(t),_.guiStart(t)});h.reg_hook_new("dash-bridge","控制桥","@/.*",{source:{ty:"enum",vals:["exlg","gh_index","debug"],dft:"exlg",info:["The website to open when clicking the exlg button","点击 exlg 按钮时打开的网页"]},beautify_dropdown:{ty:"boolean",dft:!0,info:["Beautify Dropdown","右上角用户信息卡美化"]},beautify_dash:{ty:"boolean",dft:!0,info:["Beautify Dash Board","控制桥面板美化"]},enable_rclick:{ty:"boolean",dft:!0,info:["Use Right Click to change source","右键点击按钮换源"]},latest_ignore:{ty:"string",dft:"0.0.0"}},({msto:e,args:t})=>{["exlg","gh_index","debug"].indexOf(e.source)===-1&&(e.source="exlg");let{$tar:o}=t,n=()=>_.exlg.dash=_.open({exlg:"https://dash.exlg.cc/index.html",gh_index:"https://extend-luogu.github.io/exlg-setting-new/index.html",debug:"localhost:1634/index.html"}[e.source]);if(e.beautify_dropdown){GM_addStyle(ve);let c=(g,f,x=r(f))=>{x.addClass("exlg-dash-options"),f.innerHTML=`<div class="link-title">${f.innerHTML}</div>`};if(t.type===2){c(0,o[0],o);return}let d=(g,f)=>{g.children(".header").after(`<style>${ve}</style>`).after(`
                <div style="margin-top: 0.4em;">
                    <a class="exlg-dropdown field" href="//www.luogu.com.cn/user/${L.uid}#following.following">
                        <span class="value">${L.followingCount}</span>
                        <span data-v-3c4577b8="" class="key">关注</span>
                    </a>
                    <a class="exlg-dropdown field" href="//www.luogu.com.cn/user/${L.uid}#following.follower">
                        <span class="value">${L.followerCount}</span>
                        <span data-v-3c4577b8="" class="key">粉丝</span>
                    </a>
                    <a class="exlg-dropdown field" href="//www.luogu.com.cn/user/notification">
                        <span class="value">${L.unreadNoticeCount+L.unreadMessageCount}</span>
                        <span data-v-3c4577b8="" class="key">动态</span>
                    </a>
                </div>
                `).after(`
                <div class="exlg-dropdown field">
                    <span data-v-3c4577b8="" class="key-small">CCF 评级: <strong>${L.ccfLevel}</strong> | 咕值排行: <strong>${L.ranking}</strong></span>
                </div>
                `),f.each(c);let x=r(f[5]).clone().attr("href","javascript:void 0");x.on("click",n),r(f[5]).after(x),x.children("div.link-title").html(`${Me} 插件设置`)};(o.hasClass("user-nav")||o.parent().hasClass("user-nav"))&&d(o.find(".dropdown > .center"),o.find(".ops > a"))}let l=r('<span id="exlg-dash-wrapper"></span>').prependTo(o),a=r('<span id="exlg-dash-window" class="exlg-window"></span>').css("left","-125px"),i=r('<div id="exlg-dash" exlg="exlg">exlg</div>').prependTo(l).css("backgroundColor",{exlg:"cornflowerblue",gh_index:"darkblue",debug:"steelblue"}[e.source]).css("margin-top",o.hasClass("nav-container")?"5px":"0px");if(e.enable_rclick?i.on("contextmenu",!1).on("mousedown",c=>{c.button?c.button===2&&(e.source={exlg:"gh_index",gh_index:"debug",debug:"exlg"}[e.source],i.css("backgroundColor",{exlg:"cornflowerblue",gh_index:"darkblue",debug:"steelblue"}[e.source])):n()}):i.on("click",n),!o.parent().hasClass("mobile-nav-container")){e.beautify_dash&&a.append(`<style>${Re}</style>`),a.appendTo(l),r(`<h2 align="center" style="margin-top: 5px;margin-bottom: 10px;">${de}</h2>`).appendTo(a);let c=r('<div id="exlg-windiv"></div>').appendTo(a);[{tag:"vers",title:"版本",buttons:[]},{tag:"source",title:"源码",buttons:[{html:"OSS",url:"https://exlg.oss-cn-shanghai.aliyuncs.com/latest/dist/extend-luogu.min.user.js"},{html:"Raw",url:`https://github.com/extend-luogu/extend-luogu/raw/${E["#get-latest"].fetch_preview?"preview":"latest"}/dist/extend-luogu.min.user.js`}]},{tag:"link",title:"链接",buttons:[{html:"官网",url:"https://exlg.cc"},{col:"#666",html:`<a style="height: 8px;width: 8px;">${Se}</a>Github`,url:"https://github.com/extend-luogu/extend-luogu"},{html:"爱发电",url:"https://afdian.net/@extend-luogu"}]},{tag:"help",title:"帮助",buttons:[{html:"官方",url:"https://github.com/extend-luogu/extend-luogu/blob/main/README.md"},{html:"镜像",url:"https://hub.fastgit.xyz/extend-luogu/extend-luogu/blob/main/README.md"},{html:"用户协议",url:"https://github.com/extend-luogu/extend-luogu/blob/main/POLICY.md"}]},{tag:"badge",title:"badge",buttons:[{html:"注册/修改",onclick:()=>te()}]},{tag:"debug",title:"debug",buttons:[{html:"清除所有油猴缓存",onclick:()=>{S('你确定要这么做吗？<br/><strong style="color: red;">数据将不可恢复！</strong>',"exlg 警告！",()=>(GM_listValues().forEach(GM_deleteValue),location.reload(),!0))}},{html:"强制急停",onclick:()=>{S("还没做出来，嘿嘿~")}}]}].forEach(g=>{let f=r(`<div id="${g.tag}-div"><span class="exlg-windiv-left-tag">${g.title}</span></div>`).appendTo(c),x=r("<span></span>").appendTo(f);if(g.buttons.forEach(C=>{let $=C.col??"#66ccff";r('<span class="exlg-windiv-btnspan"></span>').append(r(`<button class="exlg-windiv-btn" style="background-color: ${$};border-color: ${$};">${C.html}</button>`).on("click",C.onclick??(()=>location.href=C.url))).appendTo(x)}),g.tag==="vers"){x.append(r(`<span id="version-text" style="min-width: 60%; margin-left: 5px;">
    <span title="当前版本">${GM_info.script.version}</span>
    <span id="vers-comp-operator" style="margin-left: 5px;"></span>
    <span id="latest-version" style="margin-left: 5px;"></span>
    <span id="annoyingthings"></span></span>"`));let C=r('<button class="exlg-windiv-btn" style="background-color: red;border-color: red;float: right;margin: 0 20px 0 0;">刷新</button>'),$=x.find("#vers-comp-operator"),m=x.find("#latest-version"),u=x.find("#annoyingthings"),b=async()=>{$.text(""),m.text(""),u.html("");let[y,v]=await ge();if($.html(v).css("color",{"<<":"#fe4c61","==":"#52c41a",">>":"#3498db"}[v]),m.text(y).attr("title","最新版本"),u.html({"<<":'<i class="exlg-icon exlg-info" name="有新版本"></i>',">>":'<i class="exlg-icon exlg-info" name="内测中！"></i>'}[v]||"").children().css("cssText","position: absolute;display: inline-block;"),v==="<<"&&K(e.latest_ignore,y)==="<<"){let T=r(`<span style="color: red;margin-left: 30px;">${Ee}</span>`).on("click",()=>{e.latest_ignore=y,T.hide()}).appendTo(u)}v==="=="&&(e.latest_ignore=GM_info.script.version)};C.on("click",b).appendTo(x)}})}},e=>{let t=r(e.target);if(e.target.tagName.toLowerCase()==="a"&&t.hasClass("color-none")&&t.parent().hasClass("ops")&&!t.hasClass("exlg-dash-options"))return{result:2,args:{$tar:r(e.target),type:2}};let o=t.find(".user-nav, .nav-container");return o.length&&!o.find("#exlg-dash-window").length?{result:o.length,args:{$tar:o[0].tagName==="DIV"?r(o[0].firstChild):o,type:1}}:{result:0}},()=>({$tar:r("nav.user-nav, div.user-nav > nav, .nav-container"),type:0}),Ze,"core");var qe=".am-btn-warning{border-color:#ffc116;background-color:#ffc116;color:#fff}.am-btn-warning:hover{border-color:#f37b1d;background-color:#f37b1d;color:#fff}.am-btn{outline:none}";h.reg("discussion-save","讨论保存",["@/discuss/\\d+(\\?page\\=\\d+)*$"],{auto_save_discussion:{ty:"boolean",dft:!1,strict:!0,info:["Discussion Auto Save","自动保存讨论"]}},({msto:e})=>{let t=r('<button class="am-btn am-btn-success am-btn-sm" name="save-discuss">保存讨论</button>');t.on("click",()=>{t.prop("disabled",!0),t.text("保存中..."),F({url:`https://luogulo.gq/save.php?url=${window.location.href}`,onload:n=>{n.status===200?n.response==="success"?(M("Discuss saved"),t.text("保存成功"),setTimeout(()=>{t.text("保存讨论"),t.removeAttr("disabled")},1e3)):(M(`Discuss unsuccessfully saved, return data: ${n.response}`),t.text("保存失败"),t.toggleClass("am-btn-success").toggleClass("am-btn-warning"),setTimeout(()=>{t.text("保存讨论"),t.removeAttr("disabled"),t.toggleClass("am-btn-success").toggleClass("am-btn-warning")},1e3)):(M(`Fail to save discuss: ${n}`),t.toggleClass("am-btn-success").toggleClass("am-btn-danger"),setTimeout(()=>{t.text("保存讨论"),t.removeAttr("disabled"),t.toggleClass("am-btn-success").toggleClass("am-btn-danger")},1e3))},onerror:n=>{M(`Error:${n}`),t.removeAttr("disabled")}})}).css("margin-top","5px");let o=r(`<a class="am-btn am-btn-warning am-btn-sm" name="save-discuss" href="https://luogulo.gq/show.php?url=${location.href}">查看备份</a>`).css("margin-top","5px");r("section.lg-summary").find("p").append(r("<br>")).append(t).append(r("<span>&nbsp;</span>")).append(o),e.auto_save_discussion&&t.click()},qe,"module");var Be=".mp-editor-ground.exlg-ext.exlg-show-emo.exlg-show-emo-long{top:8.25em!important}.mp-editor-ground.exlg-ext.exlg-show-emo.exlg-show-emo-short{top:4.75em!important}.mp-editor-menu>br~li{position:relative;display:inline-block;margin:0;padding:5px 1px}.mp-editor-menu.exlg-show-emo.exlg-show-emo-long{height:6em!important;overflow:auto;background-color:#fff}.mp-editor-menu.exlg-show-emo.exlg-show-emo-short{height:2.5em!important;overflow:auto;background-color:#fff}.exlg-emo-btn{position:relative;top:0;border:none;background-color:#eee;border-radius:.7em;margin:.1em;transition:all .4s;height:2em}.exlg-emo-btn:hover{background-color:#f3f3f3;top:-3px}.exlg-emo,.exlg-ext{transition:all .15s}";var oe={EMO:1,TXT:2};h.reg("emoticon","表情输入",["@/paste","@/discuss/.*","@/"],{benben:{ty:"boolean",dft:!0,info:["Show in benben","犇犇表情"]},show:{ty:"boolean",dft:!0,info:["Show in default","是否默认显示表情栏"]},src:{ty:"enum",vals:["图.tk","github","妙.tk","啧.tk"],dft:"图.tk",info:["Emoticon Source","表情源"]},height_limit:{ty:"boolean",dft:!0,info:["Expand in default","是否默认展开表情"]}},({msto:e})=>{let t=["kk","jk","se","qq","xyx","xia","cy","ll","xk","qiao","qiang","ruo","mg","dx","youl","baojin","shq","lb","lh","qd","fad","dao","cd","kun","px","ts","kl","yiw","dk",{name:["sto"],slug:"gg",name_display:"sto",width:40},{name:["orz"],slug:"gh",name_display:"orz",width:40},{name:["qwq"],slug:"g5",name_display:"qwq",width:40},{name:["hqlm"],slug:"l0",name_display:"火前留名"},{name:["sqlm"],slug:"l1",name_display:"山前留名"},{name:["xbt"],slug:"g1",name_display:"屑标题"},{name:["iee","wee"],slug:"g2",name_display:"我谔谔"},{name:["kg"],slug:"g3",name_display:"烤咕"},{name:["gl"],slug:"g4",name_display:"盖楼"},{name:["wyy"],slug:"g6",name_display:"无意义"},{name:["wgzs"],slug:"g7",name_display:"违规紫衫"},{name:["tt"],slug:"g8",name_display:"贴贴"},{name:["jbl"],slug:"g9",name_display:"举报了"},{name:["%%%","mmm"],slug:"ga",name_display:"%%%"},{name:["ngrb"],slug:"gb",name_display:"你谷日爆"},{name:["qpzc","qp","zc"],slug:"gc",name_display:"前排资瓷"},{name:["cmzz"],slug:"gd",name_display:"臭名昭著"},{name:["zyx"],slug:"ge",name_display:"致远星"},{name:["zh"],slug:"gf",name_display:"祝好"}].filter(d=>e.src!=="啧.tk"||typeof d!="object").map((d,g)=>typeof d=="string"?{type:oe.EMO,name:[d],slug:g>=10?String.fromCharCode(97+(g-10)):String.fromCharCode(48+g)}:{type:oe.TXT,...d}),o=e.src==="github"?({slug:d})=>`//cdn.jsdelivr.net/gh/extend-luogu/extend-luogu/img/emoji/${d}`:e.src==="啧.tk"?({name:d})=>`//${e.src}/${d[0]}`:({slug:d})=>`//${e.src}/${d}`;if(e.benben&&location.pathname==="/"){let d=r("#feed-content"),g=d[0];r("#feed-content").before("<div id='emo-lst'></div>"),t.forEach(f=>{let x=r(f.type===oe.EMO?`<button class="exlg-emo-btn" exlg="exlg"><img src="${o(f)}" /></button>`:`<button class="exlg-emo-btn" exlg="exlg">${f.name_display}</button>`);x.on("click",()=>{let C=g.value,$=g.selectionStart,m=`${C.slice(0,$)}![](${o(f)})`;g.value=m+C.slice(g.selectionEnd),g.focus(),g.setSelectionRange(m.length,m.length)}).appendTo("#emo-lst"),f.width?x.css("width",`${f.width}px`):f.type===oe.EMO?x.css("width","40px"):x.css("width","83px")}),r("#feed-content").before("<br>")}let n=r(".mp-editor-menu"),l=r(".CodeMirror-wrap textarea");if(!n.length)return;let a=n.clone().addClass("exlg-emo").text("");n.after(a).append("<br />");let i=r(".mp-editor-ground").addClass("exlg-ext"),s=n.children().first().clone(!0).addClass("exlg-unselectable"),c=n.children().first().clone(!0).addClass("exlg-unselectable");n.children().last().before(s),n.children().last().before(c),s.children().attr("title","").text(e.show?"隐藏":"显示"),e.show&&(a.addClass("exlg-show-emo"),i.addClass("exlg-show-emo")),s.on("click",()=>{s.children()[0].innerHTML=["显示","隐藏"][["隐藏","显示"].indexOf(s.children()[0].innerHTML)],a.toggleClass("exlg-show-emo"),i.toggleClass("exlg-show-emo"),e.show=!e.show}),c.children().attr("title","").text(e.height_limit?"展开":"收起"),e.height_limit?(a.addClass("exlg-show-emo-short"),i.addClass("exlg-show-emo-short")):(a.addClass("exlg-show-emo-long"),i.addClass("exlg-show-emo-long")),c.on("click",()=>{c.children()[0].innerHTML=["收起","展开"][["展开","收起"].indexOf(c.children()[0].innerHTML)],a.toggleClass("exlg-show-emo-short").toggleClass("exlg-show-emo-long"),i.toggleClass("exlg-show-emo-short").toggleClass("exlg-show-emo-long"),e.height_limit=!e.height_limit}),t.forEach(d=>{let g=r(d.type===oe.EMO?`<button class="exlg-emo-btn" exlg="exlg"><img src="${o(d)}" /></button>`:`<button class="exlg-emo-btn" exlg="exlg">${d.name_display}</button>`);g.on("click",()=>l.trigger("focus").val(`![](${o(d)})`).trigger("input")).appendTo(a),d.width?g.css("width",`${d.width}px`):d.type===oe.EMO?g.css("width","40px"):g.css("width","83px")}),a.append("<div style='height: .35em'></div>")},Be,"module");var Ge="#exlg-cli{position:fixed;top:0;z-index:134;display:none;width:100%;height:40px;background-color:#fff;box-shadow:0 0 7px #1e90ff}#exlg-cli-input{display:block;height:100%;width:100%;border:none;outline:none;font-family:Fira Code,Fira Mono,consolas,Courier New;color:#000}#exlg-cli-input.error{background-color:#cd5c5c}";h.reg("keyboard-and-cli","键盘操作与命令行","@/.*",{lang:{ty:"enum",dft:"en",vals:["en","zh"]}},({msto:e})=>{let t=r('<div id="exlg-cli" exlg="exlg"></div>').appendTo(r("body")),o=r('<input id="exlg-cli-input" />').appendTo(t),n=!1,l=[],a=0,i=["en","zh"],s={".":["。"],",":["，"],"!":["！"],"?":["？"],cli:["命令行"],current:["当前"],language:["语言"],available:["可用"],command:["命令"],commands:["命令"],unknown:["未知"],forum:["板块"],target:["目标"],mod:["模块"],action:["操作"],illegal:["错误"],param:["参数"],expected:["期望"],type:["类型"],lost:["缺失"],essential:["必要"],user:["用户"]},c=i.indexOf(e.lang)||0,d=(m,...u)=>{n=!0;let b=m.map((y,v)=>y.split(/\b/).map(T=>s[T]?.[c-1]??T).join("")+(u[v]||"")).join("");return o.val(b)},g=(m,...u)=>Z(d(m,...u).addClass("error").val()),f=()=>(n=!1,o.val("").removeClass("error")),x=(m,u,b,y)=>(u=u.replace(/ /g,"").split(",").map(v=>{let T={};return v[0]==="["?(T.essential=!1,v=v.slice(1,-1)):T.essential=!0,[T.name,T.type]=v.split(":"),T}),{name:m,arg:u,help:b,fn:y}),C=[x("help","[cmd: string]",["get the help of <cmd>. or list all cmds.","获取 <cmd> 的帮助。空则列出所有"],m=>{if(!m)d`exlg cli. current language: ${c}, available commands: ${Object.keys(C).join(", ")}`;else{let u=C[m];if(!u)return g`help: unknown command "${m}"`;let b=u.arg.map(y=>{let v=`${y.name}: ${y.type}`;return y.essential?`<${v}>`:`[${v}]`}).join(" ");d`${m} ${b} ${u.help[c]}`}}),x("cd","path: string",["jump to <path>, relative path is OK.","跳转至 <path>，支持相对路径。"],m=>{let u;if(m[0]==="/")u=m;else{let b=location.pathname.replace(/^\/+/,"").split("/");m.split("/").forEach(v=>{v!=="."&&(v===".."?b.pop():b.push(v))}),u=b.join("/")}location.href=`${location.origin}/${u.replace(/^\/+/,"")}`}),x("cdd","forum: string",["jump to the forum named <forum> of discussion. use all the names you can think of.","跳转至名为 <forum> 的讨论板块，你能想到的名字基本都有用。"],m=>{let u=[["relevantaffairs","gs","gsq","灌水","灌水区","r","ra"],["academics","xs","xsb","学术","学术版","a","ac"],["siteaffairs","zw","zwb","站务","站务版","s","sa"],["problem","tm","tmzb","题目","题目总版","p"],["service","fk","fksqgd","反馈","反馈、申请、工单专版","se"]];if(m=u.find(b=>b.includes(m))?.[0],!u)return g`cdd: unknown forum "${m}"`;location.href=`https://www.luogu.com.cn/discuss/lists?forumname=${m}`}),x("cc","[name: char]",['jump to <name>, "h|p|c|r|d|i|m|n" stands for home|problem|contest|record|discuss|I myself|message|notification. or jump home.','跳转至 [name]，"h|p|c|r|d|i|m|n" 代表：主页 | 题目 | 比赛 | 评测记录 | 讨论 | 个人中心 | 私信 | 通知。空则跳转主页。'],m=>{m=m||"h";let u={h:"/",p:"/problem/list",c:"/contest/list",r:"/record/list",d:"/discuss/lists",i:`/user/${L.uid}`,m:"/chat",n:"/user/notification"}[m];u?C.cd.fn(u):g`cc: unknown target "${m}"`}),x("mod","action: string, [name: string]",['for <action> "enable|disable|toggle", opearte the mod named <name>.','当 <action> 为 "enable|disable|toggle"，对名为 <name> 的模块执行对应操作：启用 | 禁用 | 切换。'],(m,u)=>{switch(m){case"enable":case"disable":case"toggle":if(!h.has(u))return g`mod: unknown mod "${u}"`;E[u].on={enable:()=>!0,disable:()=>!1,toggle:b=>!b}[m](E[u].on);break;default:return g`mod: unknown action "${m}"`}}),x("lang","lang: string",['for <lang> "en|zh" switch current cli language.','当 <lang> 为 "en|zh"，切换当前语言。'],m=>{try{e.lang=m,c=i.indexOf(m)}catch{return g`lang: unknown language ${m}`}}),x("go","type: string, [extinfo: string]",["jumps to any corner of Luogu.","跳转到洛谷的任何一个角落。"],(m,u)=>{let b=0,y={h:["home","homepage"],p:["problem"],c:["contest"],r:["record","submission"],d:["discuss","forum"],i:["user"],m:["chat","message"],n:["notification"]},v={h:"/",p:"/problem/list",c:"/contest/list",r:"/record/list",d:"/discuss/lists",i:`/user/${L.uid}`,m:"/chat",n:"/user/notification"},T=I=>U=>isNaN(+U)?(b=1,g`unable to parse integer "${U}"`):`/${I}/${+U}`,A={p(I){return I=I.toUpperCase(),ee(I)?`/problem/${I}`:(b=1,g`unable to judge pid ${I}`)},c:T("contest"),r:T("record"),d(I){let re=[["relevantaffairs","gs","gsq","灌水","灌水区","r","ra"],["academics","xs","xsb","学术","学术版","a","ac"],["siteaffairs","zw","zwb","站务","站务版","s","sa"],["problem","tm","tmzb","题目","题目总版","p"],["service","fk","fksqgd","反馈","反馈、申请、工单专版","se"]].find(X=>X.includes(I))?.[0];return re?`/discuss/lists?forumname=${re}`:T("discuss")},i:T("user")},q="",P=m;for(let[I,U]of Object.entries(y))if(U.includes(m)){P=I;break}if(u){if(!(P in A))return g`category ${m} has no arguments`;q=A[P](u)}else q=v[P];b||(location.href=q)}),x("uid","uid: integer",["jumps to homepage of user whose uid is <uid>.","跳转至 uid 为 <uid> 的用户主页。"],m=>location.href=`/user/${m}`),x("un","name: string",["jumps to homepage of user whose username is like <name>.","跳转至用户名与 <name> 类似的用户主页。"],m=>{r.get(`/api/user/search?keyword=${m}`,u=>{u.users[0]?location.href=`/user/${u.users[0].uid}`:g`un: unknown user "${m}".`})})].reduce((m,u)=>(m[u.name]=u,m),{}),$=m=>{M(`Parsing command: "${m}"`);let u=m.trim().replace(/^\//,"").split(" "),b=u.shift();if(!b)return;let y=C[b];if(!y)return g`exlg: unknown command "${b}"`;let v=-1,T;for([v,T]of u.entries()){let A=y.arg[v].type;if((A==="number"||A==="integer")&&(u[v]=+T),!(A==="char"&&T.length===1||A==="number"&&!isNaN(u[v])||A==="integer"&&!isNaN(u[v])&&!(u[v]%1)||A==="string"))return g`${b}: illegal param "${T}", expected type ${A}.`}if(y.arg[v+1]?.essential)return g`${b}: lost essential param "${y.arg[v+1].name}"`;y.fn(...u)};o.on("keydown",m=>{switch(m.key){case"Enter":if(n)return f();let u=o.val();if(l.push(u),a=l.length,$(u),!n)return f();break;case"/":n&&f();break;case"Escape":t.hide();break;case"ArrowUp":case"ArrowDown":let b=a+{ArrowUp:-1,ArrowDown:1}[m.key];if(b<0||b>=l.length)return;a=b,o.val(l[b]);break}}),r(_).on("keydown",m=>{let u=r(document.activeElement);if(u.is("body")){let b={ArrowLeft:"prev",ArrowRight:"next"}[m.key];if(b)return r(`a[rel=${b}]`)[0].click();if(m.shiftKey){let y={ArrowUp:0,ArrowDown:1e6}[m.key];y!==void 0&&_.scrollTo(0,y)}m.key==="/"&&(t.show(),f().trigger("focus"))}else u.is("[name=captcha]")&&m.key==="Enter"&&r("#submitpost, #submit-reply")[0].click()})},Ge,"module");var Fe=".exlg-high-risk{color:#dd514c}.exlg-med-risk{color:#ff5722}.exlg-low-risk{color:#8c8c8c}";h.reg("malicious-code-identifier","有害代码检查器",["@/discuss/\\d+(\\?page\\=\\d+)*$"],{strength:{ty:"number",dft:3,min:1,max:5,step:1,info:["Strength","强度"],strict:!0}},({msto:e})=>{let t=r("code").text().toLowerCase(),o=e.strength,n=[],l=t.match("system")&&!(t.match("System.out")||t.match("import java"));o>=1&&(l&&t.match("net user")&&n.push("高危 操作用户"),l&&t.match("shutdown")&&n.push("高危 关机"),l&&t.match("socksorkstation")&&n.push("高危 锁定桌面"),l&&t.match("reg add")&&n.push("高危 注册进程")),o>=2&&(l&&t.match("taskkill")&&n.push("危险 关闭进程"),l&&t.match("setcursorpos")&&n.push("危险 修改光标")),o>=3&&(t.match("windows.h")&&n.push("可疑 引用 windows.h"),l&&(n.push("可疑 调用系统函数"),l=!0),l&&(t.match("encode")||t.match("decode"))&&n.push("高危 存在加密字符串")),n.length!==0&&S(n.join("</br>").replaceAll("高危",'<a class = "exlg-high-risk">[高危]</a>').replaceAll("危险",'<a class = "exlg-med-risk">[危险]</a>').replaceAll("可疑",'<a class = "exlg-low-risk">[可疑]</a>'),"发现有害代码")},Fe,"module");var He="a.sol-btn{transition:opacity 2s cubic-bezier(.8,0,.9,-.03);opacity:0}a.sol-btn:hover{opacity:1}.item-row{display:none}";var Je=".exlg-back-to-contest{text-decoration:none;float:right;color:#e74c3c}.exlg-back-to-contest:hover{color:#e74c3c}";h.reg("dbc-jump","双击题号跳题","@/.*",null,()=>{r(document).on("dblclick",e=>{let t=window.getSelection().toString().trim().toUpperCase(),o=e.ctrlkey?`${r(".ops > a[href*=blog]").attr("href")}solution-`:"https://www.luogu.com.cn/problem/";ee(t)&&window.open(o+t)})},`
`,"module");h.reg("hide-solution","隐藏题解",["@/problem/[A-Z0-9]+","@/problem/solution/.*"],{hidesolu:{ty:"boolean",dft:!1,priv:!0},on:{ty:"boolean",dft:!1}},()=>/@\/problem\/[A-Z0-9]+/g.test(location.href)&&r('a[href^="/problem/solution"]').addClass("sol-btn"),He,"module");h.reg_hook_new("back-to-contest","返回比赛列表",["@/problem/[A-Z0-9]+\\?contestId=[1-9][0-9]{0,}"],null,({args:e})=>{let{$info_rows:t}=e,o=r('<a class="exlg-back-to-contest"></a>'),{cid:n}=e,{pid:l}=e;!l||!n||t.children(".exlg-back-to-contest").length>0||o.attr("href",`/contest/${n}#problems`).html(`${Te}返回列表`).appendTo(t)},e=>{let t=e.target,o=w.contest.id,{pid:n}=w.problem;return{args:{cid:o,pid:n,$info_rows:r(t.parentNode)},result:t.tagName.toLowerCase()==="a"&&(t.href||"").includes("/record/list")&&t.href.slice(t.href.indexOf("/record/list"))===`/record/list?pid=${n}&contestId=${o}`}},()=>({cid:w.contest.id,pid:w.problem.pid,$info_rows:r(".info-rows").parent()}),Je,"module");h.reg_hook_new("submission-color","记录难度可视化","@/record/list.*",{reload:{ty:"boolean",dft:!0,info:["Always reload data","翻页时总是重新加载数据"]}},(e=>async({msto:t,args:o})=>{let n=async l=>{location.href in e||(t.reload&&Object.getOwnPropertyNames(e).forEach(a=>delete e[a]),e[location.href]=H(location.href)),r(l).addClass("exlg-difficulty-color").addClass(`color-${(await e[location.href]).currentData.records.result.filter(a=>a.problem.pid===l.innerText.trim())[0].problem.difficulty}`)};o?n(o.pid_tag):r(".pid").each((l,a)=>n(a))})({[location.href]:unsafeWindow._feInjection}),e=>e.target&&e.target.tagName.toLowerCase()==="a"&&/^\/problem\/[A-Z][A-Z0-9]+$/.exec(new URL(e.target.href).pathname)?{result:!0,args:{pid_tag:e.target.firstChild}}:{result:!1},()=>null,`
`,"module");h.reg("mainpage-discuss-limit","主页讨论个数限制",["@/"],{max_discuss:{ty:"number",dft:12,min:4,max:16,step:1,info:["Max Discussions On Show","主页讨论显示上限"],strict:!0}},({msto:e})=>{let t;location.href.includes("blog")||(r(".lg-article").each((o,n,l=r(n))=>{let a=n.childNodes[1];a&&a.tagName.toLowerCase()==="h2"&&a.innerText.includes("讨论")&&(t=l.children(".am-panel"))}),t.each((o,n,l=r(n))=>{o>=e.max_discuss&&l.hide()}))},`
`,"module");h.reg("user-css","自定义样式表",".*",{css:{ty:"string"}},({msto:e})=>GM_addStyle(e.css),`
`,"module");h.reg_v2({name:"original-difficulty",info:"显示原始难度",path:["@/problem/CF.*","@/problem/AT.*"],cate:"module"},{cf_src:{ty:"enum",dft:"codeforces.com",vals:["codeforces.com","codeforces.ml","codeforc.es"],info:["Codeforces problem source","CF 题目源"],migration:!0},atdiff:{ty:"string",priv:!0}},e=>{e.chore({name:"atdiff-fetch",info:"获取 AtCoder 难度",period:"10D"},null,({gsto:n})=>{let l={};F({url:"https://kenkoooo.com/atcoder/resources/problem-models.json",onload:a=>{let i=JSON.parse(a.responseText);for(let s in i)l[s]=i[s].difficulty;n.atdiff=JSON.stringify(l)}})});let t=null;e.preload({name:"load-difficulty",info:"加载原始难度"},null,({gsto:n})=>t=new Promise((l,a)=>{let i=location.pathname.match(/(CF|AT)([0-9]|[A-Z])*$/g)[0].substring(2);if(location.pathname.includes("CF")){let s=i.match(/^[0-9]*/g)[0],c=i.substring(s.length);F({url:`https://${n.cf_src}/problemset/problem/${s}/${c}`,onload:d=>{let g=r(d.responseText).find("span[title=Difficulty]").text().trim();l(g?g.substring(1):null)},onerror:d=>{O(d),a(d)}})}else{let s=JSON.parse(n.atdiff),c=w.problem.description.match(/^.{22}[-./A-Za-z0-9_]*/g)[0].match(/[^/]*$/g)[0];c in s?l(Math.round(s[c]>=400?s[c]:400/Math.exp(1-s[c]/400))):l(null)}}));let o="";e.hook({name:"difficulty-display",info:"显示原始难度"},null,({result:n,target:l})=>{if(!n)return;let a=r(l[3]),i=a.clone(!0);a.after(i);let[s,c]=i.find("span").get().map(d=>r(d));s.text("原始难度"),c.text("获取中"),t.then(d=>c.text(d??"不可用"))},n=>{if(o===location.href)return!1;let l=n.target.querySelectorAll&&n.target.querySelectorAll("div.stat > div.field");return l?.length>0?(o=location.href,{result:!0,target:l}):{result:!1}})});var Ve=".exlg-rand-settings{display:inline-block;padding:1px 5px;background-color:#fff;border:1px solid #6495ED;color:#6495ed;border-radius:6px;font-size:12px;position:relative;top:-2px}.exlg-rand-settings.selected{background-color:#6495ed;border:1px solid #6495ED;color:#fff}.exlg-rand-settings:hover{box-shadow:0 0 7px #1e90ff}.exlg-smallbtn{position:relative;display:inline-block;padding:1px 5px;color:#fff;border-radius:6px;font-size:12px;margin-left:1px;margin-right:1px}.exrand-enabled{width:49%;float:left}.exrand-disabled{width:49%;float:right}#exlg-dash-0>#exlg-exrand-window{width:250px;height:300px;z-index:6;background:white;color:#000;border-radius:7px;box-shadow:#bbe3ff 0 0 7px;visibility:hidden;opacity:0;transition:.233s ease all;position:absolute;left:-100px;top:20px;z-index:9;font-weight:initial}#exlg-dash-0:hover>#exlg-exrand-window{visibility:visible;opacity:1;transition-delay:unset}";h.reg("rand-problem-ex","随机跳题_ex","@/",{exrand_difficulty:{ty:"tuple",lvs:xe(Array.from("11111111").map(e=>!!e),{ty:"boolean",strict:!0}),priv:!0},exrand_source:{ty:"tuple",lvs:xe(Array.from("10000").map(e=>!!e),{ty:"boolean",strict:!0}),priv:!0}},({msto:e})=>{let t=[["入门","red"],["普及-","orange"],["普及/提高-","yellow"],["普及 +/提高","green"],["提高 +/省选-","blue"],["省选/NOI-","purple"],["NOI/NOI+/CTSC","black"],["暂无评定","gray"]].map((u,b,y)=>({text:u[0],color:u[1],id:(b+1)%y.length})),o=[{text:"洛谷题库",color:"red",id:"P"},{text:"Codeforces",color:"orange",id:"CF"},{text:"SPOJ",color:"yellow",id:"SP"},{text:"AtCoder",color:"green",id:"AT"},{text:"UVA",color:"blue",id:"UVA"}],n=u=>{ee(u)&&(u=u.toUpperCase()),u===""||typeof u>"u"?_.show_alert("提示","请输入题号"):location.href=`https://www.luogu.com.cn/problemnew/show/${u}`},l=r("input[name='toproblem']");l.after(l.clone()).remove(),l=r("input[name='toproblem']");let a=r(".am-btn[name='goto']");a.after(a.clone()).remove(),a=r(".am-btn[name='goto']");let i=a.parent(),s=r('<div id="exlg-dash-0" class="exlg-rand-settings">ex 设置</div>');r(".am-btn[name='gotorandom']").text("随机");let c=r('<button class="am-btn am-btn-success am-btn-sm" name="gotorandomex">随机 ex</button>').appendTo(i);a.on("click",()=>{/^[0-9]+.?[0-9]*$/.test(l.val())&&l.val(`P${l.val()}`),n(l.val())}),l.on("keydown",u=>{u.keyCode===13&&a.click()});let d=r(`<span id="exlg-exrand-window" class="exlg-window" style="display: block;">
    <br>
    <ul></ul>
    </span>`).appendTo(s).css({position:"absolute",left:"-100px",top:"20px","z-index":9,"font-weight":"initial"});r(".lg-index-stat>h2").text("问题跳转 ").append(s);let g=d.children("ul").css("list-style-type","none"),f=r('<div id="exlg-exrand-menu"></div>').appendTo(g);r("<br>").appendTo(g);let x=r('<div id="exlg-exrand-diff" class="smallbtn-list"></div>').appendTo(g),C=r('<div id="exlg-exrand-srce" class="smallbtn-list"></div>').appendTo(g).hide(),$=r.double(u=>r(`<div class="exlg-rand-settings exlg-unselectable exrand-entry">${u}</div>`).appendTo(f),"题目难度","题目来源");$[0].after(r('<span class="exlg-unselectable">&nbsp;&nbsp;</span>')),$[0].addClass("selected").css("margin-right","38px"),r.double(([u,b])=>{u.on("click",()=>{r(".exrand-entry").removeClass("selected"),u.addClass("selected"),r(".smallbtn-list").hide(),b.show()})},[$[0],x],[$[1],C]),r.double(([u,b,y])=>{let v=r.double(([T,A])=>r(`<span class="${T}">
        <span class="lg-small lg-inline-up exlg-unselectable">${A}</span>
        <br>
        </span>`).appendTo(u),["exrand-enabled","已选择"],["exrand-disabled","未选择"]);b.forEach((T,A)=>{let q=r.double(P=>r(`<div class="exlg-smallbtn exlg-unselectable">${T.text}</div>`).css("background-color",`var(--lg-${T.color}-problem)`).appendTo(P),v[0],v[1]);r.double(P=>{q[P].on("click",()=>{q[P].hide(),q[1-P].show(),y[A]=!!P}),y[A]===!!P&&q[P].hide()},0,1)})},[x,t,e.exrand_difficulty],[C,o,e.exrand_source]),r("#exlg-dash-0").on("mouseenter",()=>{r.double(([u,b])=>{r.double(([y,v])=>{u.children(y).children(".exlg-smallbtn").each((T,A,q=r(A))=>b[T]===v?q.show():q.hide())},[".exrand-enabled",!0],[".exrand-disabled",!1])},[x,e.exrand_difficulty],[C,e.exrand_source])});let m=async()=>{let u=r.double(([I,U,re])=>{let X=[];return I.forEach((me,fe)=>{U[fe]&&X.push(me.id)}),X.length||(X=re,I.forEach((me,fe)=>U[fe]=re.includes(me.id))),X[Math.floor(Math.random()*X.length)]},[t,e.exrand_difficulty,[0,1,2,3,4,5,6,7]],[o,e.exrand_source,["P"]]),b=await H(`/problem/list?difficulty=${u[0]}&type=${u[1]}&page=1`),y=b.currentData.problems.count,v=Math.ceil(y/50),T=Math.floor(Math.random()*v)+1;b=await H(`/problem/list?difficulty=${u[0]}&type=${u[1]}&page=${T}`);let A=b.currentData.problems.result,q=Math.floor(Math.random()*A.length),{pid:P}=A[q];location.href=`/problem/${P}`};c.on("click",m)},Ve,"module");var Ue=".exlg-rand-training-problem-btn{border-color:#343434;background-color:#343434}";h.reg_hook_new("rand-training-problem","题单内随机跳题","@/training/[0-9]+(#.*)?",{mode:{ty:"enum",vals:["unac only","unac and new","new only"],dft:"unac and new",info:["Preferences about problem choosing","随机跳题的题目种类"]}},({msto:e,args:t})=>{let o=e.mode.startsWith("unac")+e.mode.endsWith("only")*-1+2;!t.length||r(t[0].firstChild).clone(!0).appendTo(t).text("随机跳题").addClass("exlg-rand-training-problem-btn").on("click",()=>{let n=w.training,l=[];for(let i of n.problems){let s=n.userScore.score[i.problem.pid];(s===null&&o&1||s<i.problem.fullScore&&o&2)&&l.push(i.problem.pid)}if(!n.problemCount)return S("题单不能为空");if(!l.length)return o===1?S("您已经做完所有新题啦！"):o===2?S("您已经订完所有错题啦！"):S("您已经切完所有题啦！");let a=~~(Math.random()*1e6)%l.length;location.href=`https://www.luogu.com.cn/problem/${l[a]}`})},e=>{let t=r(e.target).find("div.operation");return{result:t.length>0,args:t}},()=>r("div.operation"),Ue,"module");var We=".exlg-badge{border-radius:50px;padding:2px 10px;transition:all .15s;display:inline;min-width:10px;font-size:1em;font-weight:700;line-height:1;vertical-align:baseline;white-space:nowrap;cursor:pointer;margin-left:2px;margin-right:2px}";h.reg_hook_new("sponsor-tag","标签显示",["@/","@/paste","@/discuss/.*","@/problem/.*","@/ranking.*","@/user/[0-9]{0,}.*"],{cache:{ty:"string",dft:"3600",info:["Cache time","缓存时间（秒）"]},badges:{ty:"string",priv:!0}},((e,t,o)=>async({msto:n,args:l})=>{r.isEmptyObject(t)&&n.badges&&Object.assign(t,JSON.parse(n.badges));let a=l.tar.map((d,g)=>{let f=g.attributes.href.value.slice(6);return!e.has(f)&&!(f in t&&B()-t[f].ts<=n.cache)?(e.add(f),f):null}).get();a.length&&o.push((async()=>{Object.assign(t,Object.fromEntries(Object.entries(await G("https://exlg.piterator.com/badge/mget",{uid:L.uid,token:E["^token"].token,data:a}).data.data).map(([d,g])=>[d,Object.assign(g,{ts:B()})])))})()),await Promise.all(o),n.badges=JSON.stringify(t);let i={"lg-fg-purple":"#8e44ad","lg-fg-red":"#e74c3c","lg-fg-orange":"#e67e22","lg-fg-green":"#5eb95e","lg-fg-bluelight":"#0e90d2","lg-fg-gray":"#bbb","lg-fg-brown":"#996600"},s=d=>{let g=d.className.slice(d.className.indexOf("lg-fg-"));return g?g.slice(0,g.indexOf(" ")):d.childNodes.length?d.childNodes[0].style.color:null},c=(d,g,f,{bg:x,fg:C,text:$,ft:m,fw:u,bd:b,fs:y})=>{let v=r(`<span class="exlg-badge" badge-uid="${d}" badge-type="${f}">${$}</span>`).css({background:(x||"mediumturquoise").replaceAll("${luogu-default}",g.includes("lg-fg-")?i[g]:g),color:C||"#fff","font-family":m||"","font-weight":u||"700","font-size":y||"",border:b||""}).on("click",()=>te());return d==="100250"?f!=="luogu4"?r(`<span class="am-badge am-radius lg-bg-${g.slice(6)}">${$}</span>`):r(`<span class="lfe-caption" style="color: rgb(255, 255, 255); background: ${g};">${$}</span>`).css({display:"inline-block",padding:"0 8px","box-sizing":"border-box","font-weight":400,"line-height":1.5,"border-radius":"2px","margin-left":"0.2em"}):v};l.tar.each((d,g)=>{let f=r(g);if(!f||f.hasClass("exlg-badge-username"))return;f.addClass("exlg-badge-username");let x=f.attr("href").slice(6);["user-feed","user-followers"].includes(l.ty)&&x==="ript:void 0"&&(x=r(g.parentNode.parentNode.previousElementSibling??g.parentNode.parentNode.parentNode.previousElementSibling).children("img").attr("src").replace(/[^0-9]/ig,""));let C=t[x];if(!C||!C.text)return;Object.keys(C).includes("lg4")||(C.lg4={}),["bg","fg","ft","fw","bd","fs","text"].forEach(b=>{C.lg4[b]||=C[b]});let $=f,m="undef";if($.next().length&&$.next().hasClass("sb_amazeui")&&($=$.next()),$.next().length&&$.next().hasClass("am-badge")&&($=$.next()),["user-feed","user-followers","no-hook-luogu4"].includes(l.ty))m="luogu4";else if(g.parentNode.tagName.toLowerCase()==="h2")m="luogu3-h2";else{if(l.ty==="no-hook"&&g.parentNode.className==="wrapper"&&!g.className.includes("lg-fg-"))return;m="luogu3"}let u=c(x,m==="luogu4"?g.childNodes[0].style.color:s(g),m,m==="luogu4"?C.lg4:C);["user-feed","user-followers"].includes(l.ty)?$.parent().after(u):$.after(u).after(r("<span>&nbsp;</span>"))})})(new Set,{},[]),e=>{if(/^\/user\/[0-9]{0,}.*$/.test(location.pathname)&&(r(e.target).hasClass("feed")&&!r(e.target).hasClass("exlg-badge-feed")||/^#following/.test(location.hash)&&r(e.target).parent().hasClass("sub-body")))return{result:r(e.target).find(".wrapper > a[target='_blank']").length,args:{tar:r(e.target).find(".wrapper > a[target='_blank']"),ty:/^#following/.test(location.hash)?"user-followers":"user-feed"}};let t=r(e.target).find("a[target='_blank'][href^='/user/']");return{result:t.length,args:{tar:t,ty:"luogu3"}}},()=>{if(/^\/user\/[0-9]{0,}.*$/.test(location.pathname)){if(location.hash==="#activity")return{tar:r(".feed .wrapper>a[target='_blank']"),ty:"no-hook-luogu4"};if(/^#following/.test(location.hash))return{tar:r(".follow-container .wrapper>a[target='_blank']"),ty:"no-hook-luogu4"}}return{tar:r("a[target='_blank'][href^='/user/']"),ty:"no-hook"}},We,"module");var Ke="iframe{border:none;display:block;width:100%;height:100%}iframe::-webkit-scrollbar{display:none}";h.reg_main("springboard","跨域跳板",["@bili/robots.txt?.*","@/robots.txt?.*"],null,()=>{let e=new URLSearchParams(location.search);switch(e.get("type")){case"update":_.addEventListener("message",o=>{o.data.unshift("update"),_.parent.postMessage(o.data,"*")});break;case"page":let t=e.get("url");(!e.get("confirm")||confirm(`是否加载来自 ${t} 的页面？`))&&(document.body.innerHTML=`<iframe src="${t}" exlg="exlg"></iframe>`);break;case"dash":break}},Ke);var Xe=".exlg-rand-tasklist-problem-btn{margin-left:.5em}";h.reg("tasklist-ex","任务计划 ex","@/",{auto_clear:{ty:"boolean",dft:!0,info:["Hide accepted problems","隐藏已经 AC 的题目"]},rand_problem_in_tasklist:{ty:"boolean",dft:!0,info:["Random problem in tasklist","任务计划随机跳题"]}},({msto:e})=>{let t=[];r.each(r("div.tasklist-item"),(a,i,s=r(i))=>{let c=s.attr("data-pid");i.innerHTML.search(/check/g)===-1&&e.rand_problem_in_tasklist&&t.push(c),s.find("i").hasClass("am-icon-check")&&s.addClass("tasklist-ac-problem")});let o=r('<div>[<a id="toggle-button">隐藏已 AC</a>]</div>');r("button[name=task-edit]").parent().after(o);let n=r(".tasklist-ac-problem"),l=r("#toggle-button").on("click",()=>{n.toggle(),l.text(`${["隐藏","显示"][+(e.auto_clear=!e.auto_clear)]}已 AC`)});if(e.auto_clear&&l.click(),e.rand_problem_in_tasklist){let a=r('<button name="task-rand" class="am-btn am-btn-sm am-btn-success lg-right">随机</button>');r("button[name='task-edit']").before(a),a.addClass("exlg-rand-tasklist-problem-btn").click(()=>{let i=~~(Math.random()*1e6)%t.length;location.href+=`problem/${t[i]}`})}},Xe,"module");h.reg_chore("token","exlg 令牌","10m","@/.*",{token:{ty:"string",priv:!0}},async({msto:e})=>{if(unsafeWindow._feInjection.currentUser){if(e.token){let o=(await G("https://exlg.piterator.com/token/ttl",{uid:unsafeWindow._feInjection.currentUser.uid,token:e.token})).data;if(o.status!==401&&o.data>=60*15)return!1}let t=(await G("https://www.luogu.com.cn/paste/new?_contentOnly",{data:(await be("https://exlg.piterator.com/token/generate")).data.data,public:!0},{"x-csrf-token":r("[name='csrf-token']").attr("content"),referer:"https://www.luogu.com.cn/paste"})).data.id;e.token=(await be(`https://exlg.piterator.com/token/verify/${t}`)).data.data.token,await G(`https://www.luogu.com.cn/paste/delete/${t}?_contentOnly`,{},{"x-csrf-token":r("[name='csrf-token']").attr("content"),referer:"https://www.luogu.com.cn/paste"})}else return!0});var Qe="-M keyboard-and-cli\n   -> `go <type: string> [extinfo: string]`\n    : 一个跳转命令，可以替代很多现有命令\n    : close #214 #219\n   -? 补充了文档\n   x- `dash`\n*M dash-bridge\n : 当 `fetch_preview` 开启时，提供预览版链接\n$M 使用 `reg_v2` 重构 blog\n-< `reg_v2` 增加了对旧版设置的迁移";var Ye=".exlg-update-log-text{overflow-x:auto;white-space:nowrap;text-align:left}";h.reg_chore("update","检查更新","1D",".*",null,async()=>{let[e,t]=await ge();t==="<<"&&S(`<p>检测到新版本 ${e}，点击确定将安装。</p>`,"检测到新版本",()=>location.href="https://exlg.oss-cn-shanghai.aliyuncs.com/latest/dist/extend-luogu.min.user.js")});var Ot=["$","#<@"].map(e=>e.split("")),et={Ty:{"-":"添加",x:"删减","!":"重大","*":"修改","^":"修复",$:"重构"},Op:{"-":"特性","?":"文档","#":"依赖","<":"代码风格",">":"命令",M:"模块",H:"钩子","@":"GitHub Action"}};h.reg("update-log","更新日志显示","@/.*",{last_version:{ty:"string",priv:!0},style:{ty:"enum",vals:["Commit Message","自然语言"],get:"id",info:["The way to display log","显示 Log 的方式"]},keep_dev:{ty:"boolean",dft:!0,info:["Keep developer messages","保留开发者更新信息"]}},({msto:e})=>{if(location.href.includes("blog"))return;let{version:t}=GM_info.script,o=!1,n=l=>{let a=`<div class="exlg-update-log-text" style="font-family: ${E["code-block-ex"].copy_code_font};">`;return l.split(`
`).forEach(i=>{let s=i.trimStart();if(s.length){if(e.keep_dev)o=!1;else if(s[0]===":"){if(!o)return}else if(Ot.some((c,d)=>c.includes(s[d]))){o=!1;return}else o=!0;e.style===1&&s[0]!==":"&&(i=" ".repeat(i.length-s.length)+et.Ty[s[0]]+et.Op[s[1]]+s.substring(2))}a+=`<div>${i.replace(/ /g,"&nbsp;")}</div>`}),`${a}</div>`};switch(K(e.last_version,t)){case"==":break;case"<<":S(n(Qe),`extend-luogu ver. ${t} 更新日志`);case">>":e.last_version=t}},Ye,"module");var tt=".exlg-usercom-edit{transition:all .4s;opacity:0;border-radius:.2em;margin-left:.2em;width:1em;height:1em;vertical-align:middle;fill:currentColor;overflow:hidden}.exlg-usercom-edit:hover{transition:all .4s;opacity:.8;background:rgba(0,0,0,.1)}.exlg-usercom-tag{color:#8a7b7b;font-weight:lighter;font-size:.9em;margin-left:.3em;line-height:1em;font-family:Consolas}";var D=null;h.reg_hook_new("user-comment","用户备注",".*",{comments:{ty:"string",dft:"{}",priv:!0},direct_display:{ty:"boolean",dft:!0,info:["Directly replace username","直接替换用户名"]}},({msto:e,result:t,args:o})=>{let n=(l,a,i=l.attr("exlg-usercom"))=>{if(!l||!l.length)return;if(l.length>1){l.each((c,d)=>n(r(d),a));return}let s=l;l.children("span[style]").length&&(s=l.children("span[style]")),e.direct_display?(s.css("white-space","pre"),s.text(a??i)):(s.children("span.exlg-usercom-tag").remove(),a&&s.append(`<span class="exlg-usercmt exlg-usercom-tag">(${a})</span>`))};if(!t){D=JSON.parse(e.comments);for(let[l,a]of Object.entries(D))(a===null||a==="")&&delete D[l];if(/^\/user\/[1-9][0-9]{0,}$/.test(location.pathname)){let l=r(".user-info > div.user-name"),a=l.text(),i=+location.pathname.slice(6);l.html("");let s=r('<span id="exlg-name-text"></span>').appendTo(l);s.text(i in D?D[i]:a);let c=r(`<span title="修改用户备注">${je}</span>`);l.append(c),c.on("click",()=>{S(`<div>请设置用户 <span style="font-family: Consolas;">${a} (uid: ${i})</span> 的备注名。<br/><small>留空则清除备注。</small></div><input exlg-badge-register type="text" style="font-family: Consolas;line-height: 1.5;padding: .1em;" class="am-form-field exlg-badge-input" placeholder="${a}" name="username" id="exlg-user-com-input">`,"exlg 用户备注",()=>{let d=r("#exlg-user-com-input").val();return d.trim()===""?(delete D[i],d=a):D[i]=d,n(r(`a[href="/user/${i}"][target=_blank]`),D[i],a),e.comments=JSON.stringify(D),s.text(i in D?D[i]:a),!0}),r("#exlg-user-com-input").val(i in D?D[i]:a)})}}o.forEach(l=>{let a=r(l),i=l.href.split("/").lastElem();typeof a.attr("exlg-usercom")<"u"||(a.attr("exlg-usercom",a.text().trim()),(!i||i==="javascript:void 0")&&(i=r(l.parentNode.parentNode.previousElementSibling??l.parentNode.parentNode.parentNode.previousElementSibling).find("img").attr("src").replace(/[^0-9]/ig,"")),i in D&&n(a,D[i]))})},e=>{if(/^\/user\/[0-9]{0,}.*$/.test(location.pathname)&&(r(e.target).hasClass("feed")&&!r(e.target).hasClass("exlg-badge-feed")||/^#following/.test(location.hash)&&r(e.target).parent().hasClass("sub-body"))){let o=e.target.querySelectorAll(".wrapper > a[target='_blank']");return{result:o.length,args:o}}let t=e.target.querySelectorAll('a[href^="/user"][target=_blank]');return{result:t.length>0,args:t}},()=>{if(/^\/user\/[0-9]{0,}.*$/.test(location.pathname)){if(location.hash==="#activity")return document.querySelectorAll(".feed .wrapper>a[target='_blank']");if(/^#following/.test(location.hash))return document.querySelectorAll(".follow-container .wrapper>a[target='_blank']")}return document.querySelectorAll("a[target='_blank'][href^='/user/']")},tt,"module");var ot="iframe{border:none;display:block}iframe::-webkit-scrollbar{display:none}";h.reg_user_tab("user-intro-ins","用户首页_HTML_显示","main",null,null,()=>{r(".introduction > *").each((e,t,o=r(t))=>{let n=o.text(),[,,l,a]=n.match(/^(exlg.|%)([a-z]+):([^]+)$/)??[];if(!l)return;let i=a.split(/(?<!!)%/g).map(c=>c.replace(/!%/g,"%")),s=r(r(".user-action").children()[0]);if(l==="html")o.replaceWith(r(`<p exlg="exlg">${Q.process(i[0])}</p>`));else if(l==="frame")o.replaceWith(se({type:"page",url:encodeURI(i[0]),confirm:!0},`width: ${i[1]}; height: ${i[2]};`));else if(l==="blog"){if(s.text().trim()!=="个人博客")return;s.attr("href",i),o.remove()}})},ot,"module");var V={NOT_AT_PRACTICE_PAGE:-1,NONE:-2,COMMENT_TAG:-3,NOT_A_PROBLEM_ELEMENT:-4,PRIVATE_INFORMATION:-5,ADD_COMPARE:1};var rt=".main>.card>h3{display:inline-block}";var ke={SUBMITTED_PROBLEMS:0,PASSED_PROBLEMS:1},_e=-1,nt=ke.SUBMITTED_PROBLEMS,pe=-1,le=null,ue=null;h.reg_hook_new("user-problem-color","题目颜色数量和比较","@/user/[0-9]{0,}.*",{problem_compare:{ty:"boolean",strict:!0,dft:!0,info:["AC compare","AC 题目比较"]}},({msto:e,args:t})=>{if(typeof t=="object"&&t.message===V.PRIVATE_INFORMATION)return;let o=[[191,191,191],[254,76,97],[243,156,17],[255,193,22],[82,196,26],[52,152,219],[157,61,207],[14,29,105]],n=async(a,i)=>{if(le===null){let c=await H(`/user/${L.uid}`);le=w.passedProblems,ue=new Set,c.currentData.passedProblems.forEach((d,g)=>ue.add(d.pid))}let s=0;i&&a[1].querySelectorAll("a").forEach((d,g)=>{g<le.length&&ue.has(le[g].pid)&&(s++,d.style.backgroundColor="rgba(82, 196, 26, 0.3)")}),r("#exlg-problem-count-1").html(`<span class="exlg-counter" exlg="exlg">${le.length} <> ${ue.size} : ${s}<i class="exlg-icon exlg-info" name="ta 的 &lt;&gt; 我的 : 相同"></i></span>`)},l=a=>`rgb(${o[a][0]}, ${o[a][1]}, ${o[a][2]})`;if(typeof t=="object"&&t.message===V.ADD_COMPARE){if(!e.problem_compare||w.user.uid===L.uid)return;n([114514,1919810],!1);return}t.forEach(a=>{if(a.target.href!=="javascript:void 0"&&(a.target.style.setProperty("color",l([(a.board_id?w.passedProblems:w.submittedProblems)[a.position].difficulty]),"important"),a.board_id===ke.PASSED_PROBLEMS&&a.position===w.passedProblems.length-1||w.passedProblems.length===0&&a.board_id===ke.SUBMITTED_PROBLEMS&&a.position===w.submittedProblems.length-1)){r(".exlg-counter").remove();let i=a.target.parentNode.parentNode.parentNode.parentNode,s=[i.firstChild.childNodes[2],i.lastChild.childNodes[2]];for(let c=0;c<2;++c){let d=s[c],g=w[["submittedProblems","passedProblems"][c]];d.before(r(`<span id="exlg-problem-count-${c}" class="exlg-counter" exlg="exlg">${g.length}</span>`)[0])}if(!e.problem_compare||w.user.uid===L.uid)return;n(s,!0)}})},e=>{if(location.hash!=="#practice")return{result:!1,args:{message:V.NOT_AT_PRACTICE_PAGE}};if(!w.submittedProblems.length&&!w.passedProblems.length){if(e.target.className==="card padding-default")if(r(e.target).children(".problems").length){let a=w[["submittedProblems","passedProblems"][pe]];if(r(e.target.firstChild).after(`<span id="exlg-problem-count-${pe}" class="exlg-counter" exlg="exlg" style="margin-left: 5px">${a.length}</span>`),++pe>1)return{result:!0,args:{message:V.ADD_COMPARE}}}else r(e.target).children(".difficulty-tags").length&&(pe=0);return{result:!1,args:{message:V.NONE}}}if(!e.target.tagName)return{result:!1,args:{message:V.COMMENT_TAG}};if(e.target.tagName.toLowerCase()!=="a"||e.target.className!=="color-default"||e.target.href.indexOf("/problem/")===-1)return{result:!1,args:{message:V.NOT_A_PROBLEM_ELEMENT}};let t=a=>a?a.pid:void 0,o=e.target,n=[t(w.submittedProblems[0]),t(w.passedProblems[0])].indexOf(o.href.slice(33)),l=n!==-1;return l?(nt=n,_e=0):_e++,{result:!0,args:[{onchange:l,board_id:nt,position:_e,target:o}]}},()=>{if(typeof w.submittedProblems>"u"||typeof w.passedProblems>"u")return{message:V.PRIVATE_INFORMATION};if(!w.submittedProblems.length&&!w.passedProblems.length){r(".exlg-counter").remove();let e=r(".card.padding-default > .problems");for(let t=0;t<2;++t){let o=r(e[t]),n=w[["submittedProblems","passedProblems"][t]];o.before(`<span id="exlg-problem-count-${t}" class="exlg-counter" exlg="exlg">${n.length}</span>`)}return{message:V.ADD_COMPARE}}return[]},rt,"module");var at="#exlg-vp{margin-right:.5em;display:inline-block;flex:none;outline:0;cursor:pointer;color:#fff;font-weight:inherit;line-height:1.5;text-align:center;vertical-align:middle;background:0 0;border-radius:3px;border:1px solid;border-color:#52c41a;background-color:#52c41a}";h.reg("virtual-participation","创建重现赛","@/contest/[0-9]*(#.*)?",{},()=>{if(w.contest.name.match("Virtual Participation")){let e=r(".items"),t=()=>{(location.hash||"#main")==="#problems"&&r(".pid").length!==0&&w.contest.startTime>B()&&(r("a.title.color-default").on("click",()=>{S("比赛尚未开始，请开始后再查看题目")}),r("a.title.color-default").removeAttr("href"))};e.on("click",t),t();return}if(w.contest.endTime>B()){Z("Contest has not started or ended.");return}r("<button id='exlg-vp' class='lfe-form-sz-middle'>重现比赛</button>").appendTo(r("div.operation")).click(async()=>{S(`<div>
                <p>设置「${w.contest.name}」的重现赛</p>
                <p>开始时间：<input type="date" id="vpTmDt"/> <input type="time" id="vpTmClk"/></p>
            </div><br>`,"创建重现赛",async()=>{let e=r("#vpTmDt")[0].value.split("-"),t=r("#vpTmClk")[0].value.split(":"),o=new Date(e[0],e[1]-1,e[2],t[0],t[1],0,0);o=o.getTime()/1e3;let n="",l="";r.each(w.contestProblems,(d,g)=>{d&&(n+=",",l+=","),n+=`"${g.problem.pid}"`,l+=`"${g.problem.pid}": ${g.problem.fullScore}`});let a=null,i=`{
                    "settings":{
                        "name": "Virtual Participation for ${w.contest.name}",
                        "description": ${JSON.stringify(w.contest.description)},
                        "visibilityType":5,
                        "invitationCodeType":1,
                        "ruleType":${w.contest.ruleType},
                        "startTime":${o},
                        "endTime":${o+w.contest.endTime-w.contest.startTime},
                        "rated":false,
                        "ratingGroup":null
                    },
                    "hostID":${L.uid}
                }`;a=await Y("/fe/api/contest/new",i);let s=a.id.toString();(a.status??200)===200?s=a.id.toString():O(`Failed to modify contest ${s} with status code ${a.status}.`),a=null;try{a=await Y(`/fe/api/contest/editProblem/${s}`,`{
                            "pids":[${n}],
                            "scores":{${l}}
                        }`)}catch{return setTimeout(S("<p>本场比赛的题目不公开</p>","重现赛创建失败"),500),!1}let c=await H(`/contest/edit/${s}`);return await Y(`/fe/api/contest/join/${s}`,`{"code": "${c.currentData.contest.joinCode}"}`),S(`<p>邀请码: ${c.currentData.contest.joinCode}</p>
                    <p>点确定自动跳转</p>`,"重现赛创建成功",()=>(location.href=`https://www.luogu.com.cn/contest/${s}`,!0)),!1})})},at,"module");h.reg("meta-discussion-guiding","元讨论引导",["@/discuss/lists\\?forumname=(siteaffairs|problem|academics|relevantaffairs|service).*"],{},()=>{let e="432028",t=[/exlg/i,/ex(tend)?[- ]luogu/i,/badge/i],o=r("#newpost"),n=r(".lg-input-title"),l=r("#submitpost"),a=l.wrap("<div></div>").parent(),i=`<a href="/discuss/${e}"><b>专贴</b></a>`;o.after(`<p>exlg 相关问题请在 ${i} 讨论</p>`),a[0].addEventListener("click",s=>{let c=_.markdownPalettes.content?.toLowerCase(),d=n.val(),g=t.map(f=>[c.match(f)?.[0],d.match(f)?.[0]]).flat().filter((f,x,C)=>f&&f!==C[x+1]);if(g.length){s.stopPropagation();let f;S(`检测到您将要发送的讨论内容包含与 exlg 有关的关键词：<br />${g.map(x=>`“${x}”`).join(", ")}<br />建议前往 ${i} 讨论。<br />这是为了防止占用讨论资源，营造一个更高质量的社区。 <br />我们很担心 exlg 相关讨论霸占版面，造成负面影响。<br /><span style="color: orange"><b>洛谷管理员提醒您：发布无意义讨论可能导致禁言。</b> <br /><small>* 无意义讨论包括但不限于“大家看得到我的 badge 吗” 等等</small></span> <br />如果您确定要发送，请在下方输入框键入 “放心” 后确定。<br/><small comment>（输入框过一会才会出现）</small>`,"exlg 提醒您",{onconfirm:()=>!f||f.val()!=="放心"?!1:(setTimeout(l.trigger("click"),500),!0),onopen:async({dom:{$main:x}})=>{await Ce(3e3),x.find("small[comment]").remove(),f=r('<input type="text" />').appendTo(x)}})}},!0)},"","module");M("Exposing");Object.assign(_,{exlg:{mod:h,compo:R,datas:N,log:M,error:O,springboard:se,version_cmp:K,lg_alert:ce,lg_content:H,register_badge:te,lg_post:Y,exlg_alert:S,TM_dat:{reload_dat:e=>(raw_dat=null,load_dat(e,{map:t=>{t.root=!t.rec,t.itmRoot=t.rec===2}})),type_dat,proxy_dat,load_dat,save_dat,clear_dat,raw_dat}},GM:{GM_info,GM_addStyle,GM_setClipboard,GM_xmlhttpRequest,GM_getValue,GM_setValue,GM_deleteValue,GM_listValues},$$:r,xss:Q,marked});var lt=e=>{try{_.exlg.TM_dat.sto=_.exlg.TM_dat.reload_dat(N),h.fake_sto=R.sto=_.exlg.TM_dat.sto}catch(t){if(e)ce("存储代理加载失败，清存重试中……"),clear_dat(),lt(e-1);else throw ce("失败次数过多，自闭中。这里建议联系开发人员呢。"),t}};try{lt(1)}catch(e){Z(e);let t=o=>{switch(o.ty){case"number":case"string":case"boolean":return o.dft;case"object":return t(o.lvs);case"enum":return o.get==="id"?o.vals[o.dft]:o.dft;case"array":return[];case"tuple":return o.lvs.map(t)}return Object.fromEntries(Object.entries(o).map(([n,l])=>[n,t(l)]))};h.fake_sto=R.sto=t(N)}h.preload();h.execute_v2();ne.preload.apply();r(()=>{M("Launching"),R.ready(),h.execute(),ne.onload.apply()});})();
